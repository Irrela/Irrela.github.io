---
title: Rust Book
categories: Rust
tags:
- Rust
---

- [Warning and Error](#warning-and-error)
- [ShortCut](#shortcut)
- [1. Getting Started](#1-getting-started)
  - [1.1 First Program](#11-first-program)
  - [1.2 Cargo](#12-cargo)
    - [ï¼ï¼ï¼Cargo æ“ä½œæ…¢](#cargo-æ“ä½œæ…¢)
    - [ä½¿ç”¨ Cargo åˆ›å»ºé¡¹ç›®](#ä½¿ç”¨-cargo-åˆ›å»ºé¡¹ç›®)
    - [Cargo.tomlç»“æ„](#cargotomlç»“æ„)
    - [ä¸ºæ²¡æœ‰ä½¿ç”¨Cargoçš„é¡¹ç›®å¼•å…¥Cargo](#ä¸ºæ²¡æœ‰ä½¿ç”¨cargoçš„é¡¹ç›®å¼•å…¥cargo)
    - [Cargoæ„å»ºä¸è¿è¡Œ](#cargoæ„å»ºä¸è¿è¡Œ)
    - [å‘å¸ƒï¼ˆreleaseï¼‰æ„å»º](#å‘å¸ƒreleaseæ„å»º)
  - [2. Guessing Game](#2-guessing-game)
    - [ä½¿ç”¨å˜é‡å‚¨å­˜å€¼](#ä½¿ç”¨å˜é‡å‚¨å­˜å€¼)
    - [é™æ€æ–¹æ³•](#é™æ€æ–¹æ³•)
    - [è¾“å…¥è¾“å‡º(std::io)](#è¾“å…¥è¾“å‡ºstdio)
    - [ä½¿ç”¨ Result ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯](#ä½¿ç”¨-result-ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯)
    - [ä½¿ç”¨ println! å ä½ç¬¦æ‰“å°å€¼](#ä½¿ç”¨-println-å ä½ç¬¦æ‰“å°å€¼)
    - [ä½¿ç”¨crate](#ä½¿ç”¨crate)
    - [Cargo.lock æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„](#cargolock-æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„)
    - [æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬](#æ›´æ–°-crate-åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬)
    - [ä½¿ç”¨randç”Ÿæˆä¸€ä¸ªéšæœºæ•°](#ä½¿ç”¨randç”Ÿæˆä¸€ä¸ªéšæœºæ•°)
    - [æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—](#æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—)
    - [é™æ€å¼ºç±»å‹ \& ç±»å‹æ¨æ–­](#é™æ€å¼ºç±»å‹--ç±»å‹æ¨æ–­)
    - [ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹](#ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹)
    - [å¤„ç†æ— æ•ˆè¾“å…¥](#å¤„ç†æ— æ•ˆè¾“å…¥)
- [3. Common Programming Concepts](#3-common-programming-concepts)
  - [3.1 Variables and Mutability](#31-variables-and-mutability)
    - [å¯å˜æ€§](#å¯å˜æ€§)
    - [å¸¸é‡](#å¸¸é‡)
    - [éšè—](#éšè—)
  - [3.2 æ•°æ®ç±»å‹](#32-æ•°æ®ç±»å‹)
    - [æ ‡é‡ç±»å‹](#æ ‡é‡ç±»å‹)
      - [æ•°å€¼è¿ç®—](#æ•°å€¼è¿ç®—)
      - [å­—ç¬¦ç±»å‹](#å­—ç¬¦ç±»å‹)
    - [å¤åˆç±»å‹](#å¤åˆç±»å‹)
      - [å…ƒç»„ç±»å‹](#å…ƒç»„ç±»å‹)
      - [æ•°ç»„ç±»å‹](#æ•°ç»„ç±»å‹)
      - [è®¿é—®æ•°ç»„å…ƒç´ ](#è®¿é—®æ•°ç»„å…ƒç´ )
  - [3.2 å‡½æ•°](#32-å‡½æ•°)
    - [](#)
    - [å…·æœ‰è¿”å›å€¼çš„å‡½æ•°](#å…·æœ‰è¿”å›å€¼çš„å‡½æ•°)
  - [3.4 æ³¨é‡Š](#34-æ³¨é‡Š)
  - [3.5 æ§åˆ¶æµ](#35-æ§åˆ¶æµ)
    - [if](#if)
    - [else if](#else-if)
    - [loopã€while å’Œ for](#loopwhile-å’Œ-for)
      - [loop](#loop)
      - [å¾ªç¯æ ‡ç­¾ï¼šåœ¨å¤šä¸ªå¾ªç¯ä¹‹é—´æ¶ˆé™¤æ­§ä¹‰](#å¾ªç¯æ ‡ç­¾åœ¨å¤šä¸ªå¾ªç¯ä¹‹é—´æ¶ˆé™¤æ­§ä¹‰)
      - [while](#while)
      - [for](#for)
- [4. Understanding Ownership](#4-understanding-ownership)
  - [4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒï¼Ÿ](#41-ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ)
    - [æ‰€æœ‰æƒè§„åˆ™](#æ‰€æœ‰æƒè§„åˆ™)
    - [å˜é‡ä½œç”¨åŸŸ](#å˜é‡ä½œç”¨åŸŸ)
    - [æ¼”ç¤ºæ‰€æœ‰æƒçš„è§„åˆ™ - String ç±»å‹](#æ¼”ç¤ºæ‰€æœ‰æƒçš„è§„åˆ™---string-ç±»å‹)
    - [å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨](#å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ä¸€ç§»åŠ¨)
    - [å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆäºŒï¼‰ï¼šå…‹éš†](#å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼äºŒå…‹éš†)
      - [åªåœ¨æ ˆä¸Šçš„æ•°æ®ï¼šæ‹·è´](#åªåœ¨æ ˆä¸Šçš„æ•°æ®æ‹·è´)
      - [Trait: Copy](#trait-copy)
      - [æ‰€æœ‰æƒä¸å‡½æ•°](#æ‰€æœ‰æƒä¸å‡½æ•°)
      - [è¿”å›å€¼ä¸ä½œç”¨åŸŸ](#è¿”å›å€¼ä¸ä½œç”¨åŸŸ)
  - [4.2 å¼•ç”¨ä¸å€Ÿç”¨](#42-å¼•ç”¨ä¸å€Ÿç”¨)
      - [å°è¯•ä¿®æ”¹å€Ÿç”¨çš„å˜é‡](#å°è¯•ä¿®æ”¹å€Ÿç”¨çš„å˜é‡)
    - [å¯å˜å¼•ç”¨](#å¯å˜å¼•ç”¨)
    - [æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referencesï¼‰](#æ‚¬å‚å¼•ç”¨dangling-references)
  - [4.3 Slice ç±»å‹](#43-slice-ç±»å‹)
      - ['' å’Œ b''](#-å’Œ-b)
      - [\&str å’Œ String](#str-å’Œ-string)
    - [å…¶ä»–ç±»å‹çš„ slice](#å…¶ä»–ç±»å‹çš„-slice)
- [5. `Structs` to Structure Related Data](#5-structs-to-structure-related-data)
  - [5.1 ç»“æ„ä½“çš„å®šä¹‰å’Œå®ä¾‹åŒ–](#51-ç»“æ„ä½“çš„å®šä¹‰å’Œå®ä¾‹åŒ–)
      - [è®¿é—®å’Œä¿®æ”¹å±æ€§](#è®¿é—®å’Œä¿®æ”¹å±æ€§)
      - [Builder](#builder)
    - [ä½¿ç”¨`ç»“æ„ä½“æ›´æ–°`è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹](#ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹)
    - [å…ƒç»„ç»“æ„ä½“ï¼ˆtuple structsï¼‰](#å…ƒç»„ç»“æ„ä½“tuple-structs)
    - [ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰](#ç±»å•å…ƒç»“æ„ä½“unit-like-structs)
  - [5.2 ç»“æ„ä½“ç¤ºä¾‹ç¨‹åº](#52-ç»“æ„ä½“ç¤ºä¾‹ç¨‹åº)
    - [é€šè¿‡æ´¾ç”Ÿ trait å¢åŠ å®ç”¨åŠŸèƒ½](#é€šè¿‡æ´¾ç”Ÿ-trait-å¢åŠ å®ç”¨åŠŸèƒ½)
    - [ä½¿ç”¨ dbg!](#ä½¿ç”¨-dbg)
  - [5.3 æ–¹æ³•è¯­æ³•](#53-æ–¹æ³•è¯­æ³•)
      - [getter](#getter)
      - [-\> è¿ç®—ç¬¦åˆ°å“ªå»äº†ï¼Ÿ](#--è¿ç®—ç¬¦åˆ°å“ªå»äº†)
    - [å¸¦æœ‰æ›´å¤šå‚æ•°çš„æ–¹æ³•](#å¸¦æœ‰æ›´å¤šå‚æ•°çš„æ–¹æ³•)
    - [å…³è”å‡½æ•°](#å…³è”å‡½æ•°)
- [6. Enums and Pattern Matching](#6-enums-and-pattern-matching)
    - [Option æšä¸¾å’Œå…¶ç›¸å¯¹äºç©ºå€¼çš„ä¼˜åŠ¿](#option-æšä¸¾å’Œå…¶ç›¸å¯¹äºç©ºå€¼çš„ä¼˜åŠ¿)
  - [6.2 match æ§åˆ¶æµç»“æ„](#62-match-æ§åˆ¶æµç»“æ„)
    - [ç»‘å®šå€¼çš„æ¨¡å¼](#ç»‘å®šå€¼çš„æ¨¡å¼)
    - [åŒ¹é… Option](#åŒ¹é…-option)


# Warning and Error

- Cargoæ›´æ–°ä¸‹è½½æ…¢
    æ¢æº, `/Users/<your user name>/.cargo` ä¸‹æ–°å»ºconfigæ–‡ä»¶ï¼š
    ```xml
    [source.crates-io]
    registry = "https://github.com/rust-lang/crates.io-index"

    replace-with = 'ustc'

    [source.ustc]
    registry = "git://mirrors.ustc.edu.cn/crates.io-index"
    ```

- `No Cargo projects are found`
    
    è¿™ä¸ªé”™è¯¯é€šå¸¸æ„å‘³ç€CLionæ— æ³•æ‰¾åˆ°ä»»ä½•Cargoé¡¹ç›®ï¼Œå› æ­¤å®ƒæ— æ³•åœ¨æ‚¨çš„Rustä»£ç ä¸Šè¿è¡ŒCargoå‘½ä»¤ã€‚
    
    æ£€é”™ï¼š
    1. ç¡®ä¿æ‚¨ä½äºæ­£ç¡®çš„ç›®å½•ä¸­ï¼šå¯¼èˆªåˆ°Rusté¡¹ç›®çš„æ ¹ç›®å½•ã€‚è¿™æ˜¯åŒ…å«Cargo.tomlæ–‡ä»¶çš„ç›®å½•ã€‚æ‚¨åº”è¯¥ä»æ­¤ç›®å½•è¿è¡Œè´§ç‰©å‘½ä»¤ã€‚
    2. åˆå§‹åŒ–Rusté¡¹ç›®ï¼šå¦‚æœæ‚¨ä¸åœ¨åŒ…å«Cargo.tomlæ–‡ä»¶çš„ç›®å½•ä¸­ï¼Œåˆ™å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ–æ–°çš„Rusté¡¹ç›®ï¼š
    > `cargo new your_project_name`

    extra:
    ä½¿ç”¨rust roveræ–°å»ºé¡¹ç›®ä¹‹åç¬¬ä¸€æ¬¡cargo checkå®Œæˆä»¥å‰ä¼šæŠ¥è¿™ä¸ªé”™ã€‚ç­‰åˆå§‹åŒ–å®Œæˆå°±å¥½äº†



- `module declaration missing`

- æ£€æŸ¥æ¨¡å—å£°æ˜(Check Module Declarations)ï¼šéªŒè¯æ‚¨å·²ç»åœ¨Rustä»£ç ä¸­å£°æ˜äº†æ¨¡å—ã€‚åœ¨Rustä¸­ï¼Œä½¿ç”¨modå…³é”®å­—å£°æ˜æ¨¡å—ã€‚ä¾‹å¦‚ï¼š
    ```rust
    // In your main.rs or lib.rs file
    mod my_module;
    ```


# ShortCut

- `cmd + option + t`: åŒ…è£¹ä»£ç å—

# 1. Getting Started
## 1.1 First Program

ç¼–è¯‘ï¼š`rustc main.rs`

ç¼–è¯‘å®Œæˆä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶`main.exe`, åŒ…å«è°ƒè¯•ä¿¡æ¯æ–‡ä»¶`main.pdb`

## 1.2 Cargo
`cargo --version` æŸ¥çœ‹ç‰ˆæœ¬

### ï¼ï¼ï¼Cargo æ“ä½œæ…¢


### ä½¿ç”¨ Cargo åˆ›å»ºé¡¹ç›®

`cargo new hello_cargo` é»˜è®¤ä¼šåœ¨ hello_cargo ç›®å½•åˆå§‹åŒ–ä¸€ä¸ª git ä»“åº“, ä»¥åŠä¸€ä¸ª.gitignore æ–‡ä»¶

å¦‚æœåœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ git ä»“åº“ä¸­è¿è¡Œ cargo newï¼Œåˆ™è¿™äº› git ç›¸å…³æ–‡ä»¶åˆ™ä¸ä¼šç”Ÿæˆï¼›å¯ä»¥é€šè¿‡è¿è¡Œ `cargo new --vcs=git` æ¥è¦†ç›–è¿™äº›è¡Œä¸ºã€‚

### Cargo.tomlç»“æ„
```rust
[package]
name = "hello_cargo"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]

```

`[dependencies]`ï¼Œæ˜¯ç½—åˆ—é¡¹ç›®ä¾èµ–çš„ç‰‡æ®µçš„å¼€å§‹ã€‚åœ¨ Rust ä¸­ï¼Œä»£ç åŒ…è¢«ç§°ä¸º `crates`ã€‚

Cargo æœŸæœ›æºæ–‡ä»¶å­˜æ”¾åœ¨ src ç›®å½•ä¸­ã€‚é¡¹ç›®æ ¹ç›®å½•åªå­˜æ”¾ READMEã€license ä¿¡æ¯ã€é…ç½®æ–‡ä»¶å’Œå…¶ä»–è·Ÿä»£ç æ— å…³çš„æ–‡ä»¶ã€‚ä½¿ç”¨ Cargo å¸®åŠ©ä½ ä¿æŒé¡¹ç›®å¹²å‡€æ•´æ´ï¼Œä¸€åˆ‡äº•äº•æœ‰æ¡ã€‚

### ä¸ºæ²¡æœ‰ä½¿ç”¨Cargoçš„é¡¹ç›®å¼•å…¥Cargo
è¦åœ¨ä»»ä½•å·²å­˜åœ¨çš„é¡¹ç›®ä¸Šå·¥ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é€šè¿‡ Git æ£€å‡ºä»£ç ï¼Œç§»åŠ¨åˆ°è¯¥é¡¹ç›®ç›®å½•å¹¶æ„å»ºï¼š

```rust
$ git clone example.org/some_project
$ cd some_project
$ cargo build
```

### Cargoæ„å»ºä¸è¿è¡Œ
1. `build`: åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œ `cargo build`, ä¼šåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ `target/debug/hello_cargo`ã€‚
   - ç”±äºé»˜è®¤çš„æ„å»ºæ–¹æ³•æ˜¯`è°ƒè¯•æ„å»ºï¼ˆdebug buildï¼‰`ï¼ŒCargo ä¼šå°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨åä¸º `debug` çš„ç›®å½•ä¸­ã€‚
   - é¦–æ¬¡è¿è¡Œ `cargo build` æ—¶ï¼Œä¹Ÿä¼šä½¿ Cargo åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼š`Cargo.lock`ã€‚è¿™ä¸ªæ–‡ä»¶è®°å½•é¡¹ç›®ä¾èµ–çš„å®é™…ç‰ˆæœ¬ã€‚è¿™ä¸ªé¡¹ç›®å¹¶æ²¡æœ‰ä¾èµ–ï¼Œæ‰€ä»¥å…¶å†…å®¹æ¯”è¾ƒå°‘ã€‚ä½ è‡ªå·±æ°¸è¿œä¹Ÿä¸éœ€è¦ç¢°è¿™ä¸ªæ–‡ä»¶ï¼Œè®© Cargo å¤„ç†å®ƒå°±è¡Œäº†ã€‚
2. `run`: åŒæ—¶ç¼–è¯‘å¹¶è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
   - Cargo ä¼šæ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰å®ƒå°±ä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œè€Œæ˜¯ç›´æ¥è¿è¡Œäº†å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚æœä¿®æ”¹äº†æºæ–‡ä»¶çš„è¯ï¼ŒCargo ä¼šåœ¨è¿è¡Œä¹‹å‰é‡æ–°æ„å»ºé¡¹ç›®
3. `check`: å¿«é€Ÿæ£€æŸ¥ä»£ç ç¡®ä¿å…¶å¯ä»¥ç¼–è¯‘ï¼Œä½†å¹¶`ä¸äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶`ã€‚
   - é€šå¸¸ `cargo check` è¦æ¯” `cargo build` å¿«å¾—å¤šï¼Œå› ä¸ºå®ƒçœç•¥äº†ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„æ­¥éª¤ã€‚
   - å¦‚æœä½ åœ¨ç¼–å†™ä»£ç æ—¶æŒç»­çš„è¿›è¡Œæ£€æŸ¥ï¼Œ`cargo check` å¯ä»¥è®©ä½ å¿«é€Ÿäº†è§£ç°åœ¨çš„ä»£ç èƒ½ä¸èƒ½æ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼å½“å‡†å¤‡å¥½ä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶æ—¶æ‰è¿è¡Œ `cargo build`

### å‘å¸ƒï¼ˆreleaseï¼‰æ„å»º
å½“é¡¹ç›®æœ€ç»ˆå‡†å¤‡å¥½å‘å¸ƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `cargo build --release` æ¥`ä¼˜åŒ–`ç¼–è¯‘é¡¹ç›®ã€‚è¿™ä¼šåœ¨ `target/release` è€Œä¸æ˜¯ `target/debug` ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚

è¿™äº›ä¼˜åŒ–å¯ä»¥è®© Rust ä»£ç è¿è¡Œçš„æ›´å¿«ï¼Œä¸è¿‡å¯ç”¨è¿™äº›ä¼˜åŒ–ä¹Ÿéœ€è¦æ¶ˆè€—æ›´é•¿çš„ç¼–è¯‘æ—¶é—´ã€‚

å¦‚æœä½ åœ¨æµ‹è¯•ä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œè¯·ç¡®ä¿è¿è¡Œ `cargo build --release` å¹¶ä½¿ç”¨ target/release ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œæµ‹è¯•ã€‚


## 2. Guessing Game

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRust è®¾å®šäº†è‹¥å¹²ä¸ªä¼šè‡ªåŠ¨å¯¼å…¥åˆ°æ¯ä¸ªç¨‹åºä½œç”¨åŸŸä¸­çš„æ ‡å‡†åº“å†…å®¹ï¼Œè¿™ç»„å†…å®¹è¢«ç§°ä¸º `é¢„å¯¼å…¥ï¼ˆprecludeï¼‰` å†…å®¹ã€‚

å¦‚æœä½ éœ€è¦çš„ç±»å‹ä¸åœ¨é¢„å¯¼å…¥å†…å®¹ä¸­ï¼Œå°±å¿…é¡»ä½¿ç”¨ `use` è¯­å¥æ˜¾å¼åœ°å°†å…¶å¼•å…¥ä½œç”¨åŸŸã€‚

`std::io` åº“æä¾›å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚

### ä½¿ç”¨å˜é‡å‚¨å­˜å€¼
åœ¨ Rust ä¸­ï¼Œ`å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„`ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦æˆ‘ä»¬ç»™å˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªå€¼å°±ä¸å†å¯ä»¥ä¿®æ”¹äº†ã€‚

åœ¨å˜é‡åå‰ä½¿ç”¨ `mut` æ¥ä½¿ä¸€ä¸ªå˜é‡å¯å˜:
```rust
let apples = 5; // ä¸å¯å˜
let mut bananas = 5; // å¯å˜
```

### é™æ€æ–¹æ³•
```rust
let mut guess = String::new();
```
`:: `è¯­æ³•è¡¨æ˜ `new` æ˜¯ `String` ç±»å‹çš„ä¸€ä¸ª `å…³è”å‡½æ•°ï¼ˆassociated functionï¼‰`ã€‚

å…³è”å‡½æ•°æ˜¯é’ˆå¯¹ç±»å‹å®ç°çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ Stringï¼Œè€Œä¸æ˜¯ String çš„æŸä¸ªç‰¹å®šå®ä¾‹ã€‚ä¸€äº›è¯­è¨€ä¸­æŠŠå®ƒç§°ä¸º `é™æ€æ–¹æ³•ï¼ˆstatic methodï¼‰`ã€‚

### è¾“å…¥è¾“å‡º(std::io)
```rust
    io::stdin()
        .read_line(&mut guess)
        .`expect`("Failed to read line");
```
- å¦‚æœç¨‹åºçš„å¼€å¤´æ²¡æœ‰ä½¿ç”¨ use std::io; å¼•å…¥ io åº“ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡æŠŠå‡½æ•°è°ƒç”¨å†™æˆ std::io::stdin æ¥ä½¿ç”¨å‡½æ•°ã€‚
- è°ƒç”¨ `read_line` æ–¹æ³•ä»æ ‡å‡†è¾“å…¥å¥æŸ„è·å–ç”¨æˆ·è¾“å…¥ã€‚å°† `&mut guess` ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `read_line()` å‡½æ•°ï¼Œè®©å…¶å°†ç”¨æˆ·è¾“å…¥å‚¨å­˜åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚
- `read_line` çš„å·¥ä½œæ˜¯ï¼Œæ— è®ºç”¨æˆ·åœ¨æ ‡å‡†è¾“å…¥ä¸­é”®å…¥ä»€ä¹ˆå†…å®¹ï¼Œéƒ½å°†å…¶`è¿½åŠ ï¼ˆä¸ä¼šè¦†ç›–å…¶åŸæœ‰å†…å®¹ï¼‰`åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå› æ­¤å®ƒéœ€è¦å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚
- `&` è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª `å¼•ç”¨ï¼ˆreferenceï¼‰`ï¼Œå®ƒå…è®¸å¤šå¤„ä»£ç è®¿é—®åŒä¸€å¤„æ•°æ®ï¼Œè€Œæ— éœ€åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´ã€‚


### ä½¿ç”¨ Result ç±»å‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯

```rust
    io::stdin()
        .read_line(&mut guess)
        .expect("Failed to read line");
```
- `read_line` ä¼šå°†ç”¨æˆ·è¾“å…¥é™„åŠ åˆ°ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œè¿”å›ä¸€ä¸ªç±»å‹ä¸º `Result` çš„å€¼
- `Result` æ˜¯ä¸€ç§æšä¸¾ç±»å‹ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ `enum` ã€‚æšä¸¾ç±»å‹å˜é‡çš„å€¼å¯ä»¥æ˜¯`å¤šç§å¯èƒ½çŠ¶æ€`ä¸­çš„ä¸€ä¸ªã€‚æˆ‘ä»¬æŠŠæ¯ç§å¯èƒ½çš„çŠ¶æ€ç§°ä¸ºä¸€ç§ `æšä¸¾æˆå‘˜ï¼ˆvariantï¼‰`ã€‚
- `Result` çš„æˆå‘˜æ˜¯ `Ok` å’Œ `Err`:
  - `Ok` æˆå‘˜è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå†…éƒ¨åŒ…å«æˆåŠŸæ—¶äº§ç”Ÿçš„å€¼ã€‚ 
  - `Err` æˆå‘˜åˆ™æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”åŒ…å«å¤±è´¥çš„å‰å› åæœã€‚
- `Result` çš„å®ä¾‹æ‹¥æœ‰ `expect` æ–¹æ³•ã€‚
  - å¦‚æœ `io::Result` å®ä¾‹çš„å€¼æ˜¯ `Err` ï¼Œ `expect` ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶æ˜¾ç¤ºå½“åšå‚æ•°ä¼ é€’ç»™ `expect` çš„ä¿¡æ¯ã€‚
  - å¦‚æœ `Result` å®ä¾‹çš„å€¼æ˜¯ `Ok`, `expect` ä¼šè·å– `Ok` ä¸­çš„å€¼å¹¶åŸæ ·è¿”å›ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æˆ·è¾“å…¥åˆ°æ ‡å‡†è¾“å…¥ä¸­çš„å­—èŠ‚æ•°ã€‚

### ä½¿ç”¨ println! å ä½ç¬¦æ‰“å°å€¼

`{} `æ˜¯é¢„ç•™åœ¨ç‰¹å®šä½ç½®çš„å ä½ç¬¦.

å½“æ‰“å°å˜é‡çš„å€¼æ—¶ï¼Œ`å˜é‡åå¯ä»¥å†™è¿›å¤§æ‹¬å·ä¸­`ã€‚å½“æ‰“å°è¡¨è¾¾å¼çš„æ‰§è¡Œç»“æœæ—¶ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆformat stringï¼‰ä¸­å¤§æ‹¬å·ä¸­ç•™ç©ºï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åè·Ÿé€—å·åˆ†éš”çš„éœ€è¦æ‰“å°çš„è¡¨è¾¾å¼åˆ—è¡¨ï¼Œå…¶é¡ºåºä¸æ¯ä¸€ä¸ªç©ºå¤§æ‹¬å·å ä½ç¬¦çš„é¡ºåºä¸€è‡´ã€‚

```rust
let x = 5;
let y = 10;
println!("x = {x} and y + 2 = {}", y + 2);
```
è¿™è¡Œä»£ç ä¼šæ‰“å°å‡º` x = 5` and `y + 2 = 12`ã€‚

### ä½¿ç”¨crate
`crate` åˆ†ä¸º`åº“crate`å’Œ`äºŒè¿›åˆ¶crate`ï¼š
  - åº“crate å¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ï¼Œä½†æ˜¯ä¸èƒ½è‡ªæ‰§è¡Œ
  - äºŒè¿›åˆ¶crateï¼Œå¦‚æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„é¡¹ç›®ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶

Cargo å¯¹å¤–éƒ¨ crate çš„è¿ç”¨æ˜¯å…¶çœŸæ­£çš„äº®ç‚¹æ‰€åœ¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ rand ç¼–å†™ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ Cargo.toml æ–‡ä»¶ï¼Œå¼•å…¥ä¸€ä¸ª rand ä¾èµ–ã€‚
```toml
[dependencies]
rand = "0.8.5"
```
> 0.8.5 äº‹å®ä¸Šæ˜¯ `^0.8.5 `çš„ç®€å†™ï¼Œå®ƒè¡¨ç¤ºä»»ä½•è‡³å°‘æ˜¯ 0.8.5 ä½†å°äº 0.9.0 çš„ç‰ˆæœ¬ã€‚


### Cargo.lock æ–‡ä»¶ç¡®ä¿æ„å»ºæ˜¯å¯é‡ç°çš„

Cargo æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ç¡®ä¿ä»»ä½•äººåœ¨ä»»ä½•æ—¶å€™é‡æ–°æ„å»ºä»£ç ï¼Œéƒ½ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼šCargo åªä¼šä½¿ç”¨ä½ æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬ï¼Œé™¤éä½ åˆæ‰‹åŠ¨æŒ‡å®šäº†åˆ«çš„ã€‚

Rust åœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶å»ºç«‹äº† Cargo.lock æ–‡ä»¶, å½“å°†æ¥æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargo ä¼šå‘ç° Cargo.lock å·²å­˜åœ¨å¹¶ä½¿ç”¨å…¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å†æ¬¡è®¡ç®—æ‰€æœ‰çš„ç‰ˆæœ¬. ä¾‹å¦‚ï¼Œå¦‚æœä¸‹å‘¨ rand crate çš„ 0.8.6 ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œå®ƒä¿®å¤äº†ä¸€ä¸ªé‡è¦çš„ bugï¼ŒåŒæ—¶ä¹Ÿå«æœ‰ä¸€ä¸ªä¼šç ´åä»£ç è¿è¡Œçš„ç¼ºé™·, å¤šäºæœ‰äº† Cargo.lock æ–‡ä»¶, é¡¹ç›®ä¼šæŒç»­ä½¿ç”¨ 0.8.5 ç›´åˆ°ä½ æ˜¾å¼å‡çº§ã€‚


### æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬
`cargo update` ä¼šå¿½ç•¥ Cargo.lock æ–‡ä»¶ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆ Cargo.toml å£°æ˜çš„æœ€æ–°ç‰ˆæœ¬. Cargo æ¥ä¸‹æ¥ä¼šæŠŠè¿™äº›ç‰ˆæœ¬å†™å…¥ Cargo.lock æ–‡ä»¶ã€‚

ä¸è¿‡ï¼ŒCargo é»˜è®¤åªä¼šå¯»æ‰¾å¤§äº 0.8.5 è€Œå°äº 0.9.0 çš„ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ 0.9.0 ç‰ˆæœ¬çš„ rand æˆ–æ˜¯ä»»ä½• 0.9.x ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œå¿…é¡»åƒè¿™æ ·æ›´æ–° Cargo.toml æ–‡ä»¶ï¼š
```toml
[dependencies]

rand = "0.9.0"
```
ä¸‹ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶ï¼ŒCargo ä¼šä» registry æ›´æ–°å¯ç”¨çš„ crateï¼Œå¹¶æ ¹æ®ä½ æŒ‡å®šçš„æ–°ç‰ˆæœ¬é‡æ–°è®¡ç®—ã€‚


### ä½¿ç”¨randç”Ÿæˆä¸€ä¸ªéšæœºæ•°
```rust
use rand::Rng;
// ...
    let secret_number =
        rand::thread_rng()
            .gen_range(1..=100);
```
- `Rng` æ˜¯ä¸€ä¸ª `trait` ï¼Œå®ƒå®šä¹‰äº†éšæœºæ•°ç”Ÿæˆå™¨åº”å®ç°çš„æ–¹æ³•
- `rand::thread_rng` å‡½æ•°æä¾›å®é™…ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šå®ƒä½äºå½“å‰æ‰§è¡Œçº¿ç¨‹çš„æœ¬åœ°ç¯å¢ƒä¸­ï¼Œå¹¶ä»æ“ä½œç³»ç»Ÿè·å– seed
- æ¥ç€è°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨çš„ `gen_range` æ–¹æ³•: è·å–ä¸€ä¸ªèŒƒå›´è¡¨è¾¾å¼ï¼ˆrange expressionï¼‰ä½œä¸ºå‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåœ¨æ­¤èŒƒå›´ä¹‹é—´çš„éšæœºæ•°:
  - è¿™é‡Œä½¿ç”¨çš„è¿™ç±»èŒƒå›´è¡¨è¾¾å¼ä½¿ç”¨äº† `start..=end` è¿™æ ·çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ…å«äº†ä¸Šä¸‹ç«¯ç‚¹ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š `1..=100` æ¥è¯·æ±‚ä¸€ä¸ª 1 å’Œ 100 ä¹‹é—´çš„æ•°ã€‚

> ä½ ä¸å¯èƒ½å‡­ç©ºå°±çŸ¥é“åº”è¯¥ use å“ªä¸ª trait ä»¥åŠè¯¥ä» crate ä¸­è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œå› æ­¤æ¯ä¸ª crate æœ‰ä½¿ç”¨è¯´æ˜æ–‡æ¡£ã€‚
> Cargo æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯ï¼šè¿è¡Œ `cargo doc --open` å‘½ä»¤æ¥æ„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚
> ä¾‹å¦‚ï¼Œå‡è®¾ä½ å¯¹ rand crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è¿è¡Œ `cargo doc --open` å¹¶ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„ randã€‚


### æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—
```rust
use std::cmp::Ordering;

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal => println!("You win!"),
    }

```
- `Ordering` ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¸è¿‡å®ƒçš„æˆå‘˜æ˜¯ `Less` `ã€Greater` å’Œ `Equal` ã€‚è¿™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå€¼æ—¶å¯èƒ½å‡ºç°çš„ä¸‰ç§ç»“æœã€‚
- `cmp` æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼, å¹¶å¯ä»¥åœ¨ä»»ä½•å¯æ¯”è¾ƒçš„å€¼ä¸Šè°ƒç”¨ã€‚å®ƒè·å–ä¸€ä¸ªè¢«æ¯”è¾ƒå€¼çš„å¼•ç”¨ï¼šè¿™é‡Œæ˜¯æŠŠ guess ä¸ secret_number åšæ¯”è¾ƒã€‚ç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ª `Ordering` æšä¸¾çš„æˆå‘˜ã€‚
- `match` è¡¨è¾¾å¼ï¼Œæ ¹æ®å¯¹ guess å’Œ secret_number è°ƒç”¨ cmp è¿”å›çš„ Ordering æˆå‘˜æ¥å†³å®šæ¥ä¸‹æ¥åšä»€ä¹ˆã€‚


### é™æ€å¼ºç±»å‹ & ç±»å‹æ¨æ–­
Rust æœ‰ä¸€ä¸ª`é™æ€å¼ºç±»å‹`ç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿæœ‰`ç±»å‹æ¨æ–­`ã€‚

å½“æˆ‘ä»¬å†™å‡º `let guess = String::new()` æ—¶ï¼ŒRust æ¨æ–­å‡º `guess` åº”è¯¥æ˜¯ `String` ç±»å‹ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å†™å‡ºç±»å‹ã€‚

å¦ä¸€æ–¹é¢ï¼Œ`secret_number`ï¼Œæ˜¯æ•°å­—ç±»å‹ã€‚Rust é»˜è®¤ä½¿ç”¨ `i32` ï¼Œæ‰€ä»¥å®ƒæ˜¯ secret_number çš„ç±»å‹ï¼Œé™¤éå¢åŠ ç±»å‹ä¿¡æ¯ï¼Œæˆ–ä»»ä½•èƒ½è®© Rust æ¨æ–­å‡ºä¸åŒæ•°å€¼ç±»å‹çš„ä¿¡æ¯ã€‚
> Rustçš„ä¸€äº›æ•°å­—ç±»å‹çš„å€¼å¯ä»¥ä»‹äº1å’Œ100ä¹‹é—´ï¼ši32ä¸º 32ä½æ•°å­—ï¼›u32ä¸º æ— ç¬¦å·32ä½æ•°å­—ï¼›i64ä¸º64ä½æ•°å­—ï¼›ä»¥åŠå…¶ä»–

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠä»è¾“å…¥ä¸­è¯»å–åˆ°çš„ `String` è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ•°å­—ç±»å‹ï¼Œæ‰å¥½ä¸ `secret_number` è¿›è¡Œæ¯”è¾ƒã€‚

```rust
    let guess: u32 =
        guess.trim()
            .parse()
            .expect("Please type a number!");
```
è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«åš guess çš„å˜é‡ã€‚ä¸è¿‡ç­‰ç­‰ï¼Œä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªå«åš guess çš„å˜é‡äº†å—ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ Rust å…è®¸ç”¨ä¸€ä¸ªæ–°å€¼æ¥ `éšè— ï¼ˆShadowingï¼‰` guess ä¹‹å‰çš„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½å¸¸ç”¨åœ¨éœ€è¦`è½¬æ¢å€¼ç±»å‹`ä¹‹ç±»çš„åœºæ™¯ã€‚å®ƒå…è®¸æˆ‘ä»¬`å¤ç”¨ guess` å˜é‡çš„åå­—ï¼Œè€Œä¸æ˜¯è¢«è¿«åˆ›å»ºä¸¤ä¸ªä¸åŒå˜é‡ï¼Œè¯¸å¦‚ guess_str å’Œ guess ä¹‹ç±»ã€‚

- String å®ä¾‹çš„ `trim` æ–¹æ³•ä¼šå»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦. 
  - ç”¨æˆ·å¿…é¡»è¾“å…¥ `enter` é”®æ‰èƒ½è®© read_line è¿”å›å¹¶è¾“å…¥ä»–ä»¬çš„çŒœæƒ³ï¼Œè¿™å°†ä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ä¸€ä¸ª`æ¢è¡Œï¼ˆnewlineï¼‰ç¬¦`ã€‚
  - ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥ 5 å¹¶æŒ‰ä¸‹ enterï¼ˆåœ¨ Windows ä¸Šï¼ŒæŒ‰ä¸‹ enter é”®ä¼šå¾—åˆ°ä¸€ä¸ªå›è½¦ç¬¦å’Œä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œ`\r\n`ï¼‰ï¼Œguess çœ‹èµ·æ¥åƒè¿™æ ·ï¼š5\n æˆ–è€… 5\r\nã€‚
  - \n ä»£è¡¨ â€œæ¢è¡Œâ€; \r ä»£è¡¨ â€œå›è½¦â€
  - trim æ–¹æ³•ä¼šæ¶ˆé™¤ \n æˆ–è€… \r\nï¼Œåªç•™ä¸‹ 5ã€‚


String å®ä¾‹çš„ `parse` æ–¹æ³• å°†å­—ç¬¦ä¸²è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚
  - è¿™é‡Œç”¨å®ƒæ¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å€¼ã€‚
  - æˆ‘ä»¬éœ€è¦å‘Šè¯‰ Rust å…·ä½“çš„æ•°å­—ç±»å‹ï¼Œguess åé¢çš„å†’å· `:` æŒ‡å®šäº†å˜é‡çš„ç±»å‹ `u32`
  - `parse` æ–¹æ³•åªæœ‰åœ¨ String é€»è¾‘ä¸Šå¯ä»¥è½¬æ¢ä¸ºæ•°å­—çš„æ—¶å€™æ‰èƒ½å·¥ä½œ, æ‰€ä»¥éå¸¸å®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼Œ`parse` æ–¹æ³•è¿”å›ä¸€ä¸ª `Result` ç±»å‹ã€‚å¦‚æœ `parse` ä¸èƒ½ä»å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œè¿”å›ä¸€ä¸ª `Err` æˆå‘˜


### ä½¿ç”¨å¾ªç¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹

`loop` å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚æˆ‘ä»¬ä¼šå¢åŠ å¾ªç¯æ¥ç»™ç”¨æˆ·æ›´å¤šæœºä¼šçŒœæ•°å­—ï¼š

```rust
    loop {
        print!("You guessed: {guess}");

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => println!("You win!"),
        }
    }
```

æˆ‘ä»¬æƒ³è¦å½“çŒœæµ‹æ­£ç¡®çš„æ•°å­—æ—¶æ¸¸æˆåœæ­¢, å¢åŠ ä¸€ä¸ª `break` è¯­å¥:
```rust
    loop {
        print!("You guessed: {guess}");

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
```

é€€å‡ºå¾ªç¯ä¹Ÿæ„å‘³ç€é€€å‡ºç¨‹åºï¼Œå› ä¸ºå¾ªç¯æ˜¯ main çš„æœ€åä¸€éƒ¨åˆ†ã€‚

### å¤„ç†æ— æ•ˆè¾“å…¥
```rust
        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };
```
- æˆ‘ä»¬å°† `expect` è°ƒç”¨æ¢æˆ `match` è¯­å¥ï¼Œä»¥ä»é‡åˆ°é”™è¯¯å°±å´©æºƒè½¬æ¢ä¸ºå¤„ç†é”™è¯¯.
- `Err(_)` æ¨¡å¼ï¼š`_` æ˜¯ä¸€ä¸ªé€šé…ç¬¦å€¼ï¼Œæœ¬ä¾‹ä¸­ç”¨æ¥åŒ¹é…æ‰€æœ‰ Err å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç§ä¿¡æ¯
- break, continueå¿…é¡»å¤„äºloopä¸­


# 3. Common Programming Concepts
## 3.1 Variables and Mutability
### å¯å˜æ€§
Rustå˜é‡é»˜è®¤æ˜¯ä¸å¯æ”¹å˜çš„ï¼ˆimmutableï¼‰: å½“å˜é‡ä¸å¯å˜æ—¶ï¼Œä¸€æ—¦å€¼è¢«ç»‘å®šä¸€ä¸ªåç§°ä¸Šï¼Œä½ å°±ä¸èƒ½æ”¹å˜è¿™ä¸ªå€¼ã€‚ å¦åˆ™å°±ä¼šæŠ¥é”™
Error: `cannot assign twice to immutable variable`

ä¸è¿‡`å¯å˜æ€§`ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå°½ç®¡å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œä½ ä»ç„¶å¯ä»¥åœ¨å˜é‡åå‰æ·»åŠ  `mut` æ¥ä½¿å…¶å¯å˜

```rust
fn main() {
    let mut x = 5;
    println!("The value of x is: {x}");
    x = 6;
    println!("The value of x is: {x}");
}
```
é€šè¿‡ `mut` ï¼Œå…è®¸æŠŠç»‘å®šåˆ° x çš„å€¼ä» 5 æ”¹æˆ 6ã€‚

### å¸¸é‡
ç±»ä¼¼äºä¸å¯å˜å˜é‡ï¼Œ`å¸¸é‡ (constants)` æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåç§°çš„ä¸å…è®¸æ”¹å˜çš„å€¼ï¼Œä¸è¿‡å¸¸é‡ä¸å˜é‡è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ï¼š
- ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ `mut`, å¸¸é‡ä¸å…‰é»˜è®¤ä¸å¯å˜ï¼Œå®ƒæ€»æ˜¯ä¸å¯å˜ã€‚
- å£°æ˜å¸¸é‡ä½¿ç”¨ `const` å…³é”®å­—è€Œä¸æ˜¯ letï¼Œå¹¶ä¸” `å¿…é¡» æ³¨æ˜å€¼çš„ç±»å‹`ã€‚
- å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸä¸­å£°æ˜ï¼ŒåŒ…æ‹¬`å…¨å±€ä½œç”¨åŸŸ`ï¼Œè¿™åœ¨ä¸€ä¸ªå€¼éœ€è¦è¢«å¾ˆå¤šéƒ¨åˆ†çš„ä»£ç ç”¨åˆ°æ—¶å¾ˆæœ‰ç”¨ã€‚
- å¸¸é‡åªèƒ½è¢«è®¾ç½®ä¸º`å¸¸é‡è¡¨è¾¾å¼`ï¼Œè€Œ`ä¸å¯ä»¥æ˜¯`å…¶ä»–ä»»ä½•`åªèƒ½åœ¨è¿è¡Œæ—¶è®¡ç®—å‡ºçš„å€¼`ã€‚
- Rust å¯¹å¸¸é‡çš„`å‘½åçº¦å®š`æ˜¯åœ¨å•è¯ä¹‹é—´ä½¿ç”¨å…¨å¤§å†™åŠ ä¸‹åˆ’çº¿
  
```rust
const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
```

> åœ¨å£°æ˜å®ƒçš„ä½œç”¨åŸŸä¹‹ä¸­ï¼Œå¸¸é‡åœ¨æ•´ä¸ªç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­éƒ½æœ‰æ•ˆï¼Œæ­¤å±æ€§ä½¿å¾—å¸¸é‡å¯ä»¥ä½œä¸ºå¤šå¤„ä»£ç ä½¿ç”¨çš„å…¨å±€èŒƒå›´çš„å€¼ï¼Œä¾‹å¦‚ä¸€ä¸ªæ¸¸æˆä¸­æ‰€æœ‰ç©å®¶å¯ä»¥è·å–çš„æœ€é«˜åˆ†æˆ–è€…å…‰é€Ÿã€‚
>
> å°†éå¸ƒäºåº”ç”¨ç¨‹åºä¸­çš„ç¡¬ç¼–ç å€¼å£°æ˜ä¸ºå¸¸é‡ï¼Œèƒ½å¸®åŠ©åæ¥çš„ä»£ç ç»´æŠ¤äººå‘˜äº†è§£å€¼çš„æ„å›¾ã€‚å¦‚æœå°†æ¥éœ€è¦ä¿®æ”¹ç¡¬ç¼–ç å€¼ï¼Œä¹Ÿåªéœ€ä¿®æ”¹æ±‡èšäºä¸€å¤„çš„ç¡¬ç¼–ç å€¼ã€‚

### éšè—
æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡ã€‚å®é™…ä¸Šï¼Œç¬¬äºŒä¸ªå˜é‡â€œé®è”½â€äº†ç¬¬ä¸€ä¸ªå˜é‡ï¼Œ æ­¤æ—¶ä»»ä½•ä½¿ç”¨è¯¥å˜é‡åçš„è¡Œä¸ºï¼Œç¼–è¯‘å™¨å°†å…¶è§†ä¸ºæ˜¯åœ¨ä½¿ç”¨ç¬¬äºŒä¸ªå˜é‡ï¼Œç›´åˆ°ç¬¬äºŒä¸ªå˜é‡è‡ªå·±ä¹Ÿè¢«éšè—æˆ–ç¬¬äºŒä¸ªå˜é‡çš„ä½œç”¨åŸŸç»“æŸã€‚

å¯ä»¥ç”¨ç›¸åŒå˜é‡åç§°æ¥éšè—ä¸€ä¸ªå˜é‡ï¼Œä»¥åŠ`é‡å¤ä½¿ç”¨ let å…³é”®å­—æ¥å¤šæ¬¡éšè—`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```rust
fn main() {
    let x = 5;

    let x = x + 1;

    {
        let x = x * 2;
        println!("The value of x in the inner scope is: {x}");
    }

    println!("The value of x is: {x}");
}

// The value of x in the inner scope is: 12
// The value of x is: 6
```

`éšè—`ä¸å°†å˜é‡æ ‡è®°ä¸º `mut` æ˜¯æœ‰åŒºåˆ«çš„: 
- å½“ä¸å°å¿ƒå°è¯•å¯¹å˜é‡é‡æ–°èµ‹å€¼æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ `let` å…³é”®å­—ï¼Œå°±ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ã€‚
- é€šè¿‡ä½¿ç”¨ `let` ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå€¼è¿›è¡Œä¸€äº›è®¡ç®—ï¼Œä¸è¿‡è®¡ç®—å®Œä¹‹åå˜é‡ä»ç„¶æ˜¯`ä¸å¯å˜`çš„ã€‚
- å½“å†æ¬¡ä½¿ç”¨ `let` æ—¶ï¼Œå®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ª`æ–°å˜é‡`ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜å€¼çš„`ç±»å‹`ï¼Œå¹¶ä¸”å¤ç”¨è¿™ä¸ªåå­—ã€‚
    ```rust
        let spaces = "   "; // å­—ç¬¦ä¸²ç±»å‹
        let spaces = spaces.len(); // æ•°å­—ç±»å‹
    ```


## 3.2 æ•°æ®ç±»å‹

Rust æ˜¯ `é™æ€ç±»å‹ï¼ˆstatically typedï¼‰`è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨`ç¼–è¯‘æ—¶`å°±å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚

æ ¹æ®å€¼åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œç¼–è¯‘å™¨é€šå¸¸å¯ä»¥`æ¨æ–­`å‡ºæˆ‘ä»¬æƒ³è¦ç”¨çš„ç±»å‹ã€‚
å½“å¤šç§ç±»å‹å‡æœ‰å¯èƒ½æ—¶ï¼Œå¿…é¡»å¢åŠ `ç±»å‹æ³¨è§£`:
```rust
let guess: u32 = "42".parse().expect("Not a number!"); // ç±»å‹æ³¨è§£ : u32
```
> ç¼ºä¹ç±»å‹æ³¨è§£æŠ¥é”™
> error[E0282]: type annotations needed 


### æ ‡é‡ç±»å‹

`æ ‡é‡ï¼ˆscalarï¼‰`ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å€¼ã€‚Rust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼š
- æ•´å‹
- æµ®ç‚¹å‹
- å¸ƒå°”ç±»å‹
- å­—ç¬¦ç±»å‹

#### æ•°å€¼è¿ç®—
```rust
fn main() {
    // addition
    let sum = 5 + 10;

    // subtraction
    let difference = 95.5 - 4.3;

    // multiplication
    let product = 4 * 30;

    // division
    let quotient = 56.7 / 32.2;
    let truncated = -5 / 3; // ç»“æœä¸º -1

    // remainder
    let remainder = 43 % 5;
}
```
> `æ•´æ•°é™¤æ³•`ä¼šå‘`é›¶èˆå…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°`ã€‚


#### å­—ç¬¦ç±»å‹
Rust çš„ `char` ç±»å‹æ˜¯è¯­è¨€ä¸­æœ€åŸç”Ÿçš„å­—æ¯ç±»å‹
```rust
fn main() {
    let c = 'z';
    let z: char = 'â„¤'; // with explicit type annotation
    let heart_eyed_cat = 'ğŸ˜»';
}
```
- ç”¨å•å¼•å·å£°æ˜ `char` å­—é¢é‡. `char` ç±»å‹çš„å¤§å°ä¸ºå››ä¸ªå­—èŠ‚ (four bytes)
- ä½¿ç”¨åŒå¼•å·å£°æ˜ `å­—ç¬¦ä¸²å­—é¢é‡(String Literals)`ï¼Œ å…¶æ•°æ®ç±»å‹ä¸º`&str`

### å¤åˆç±»å‹
`å¤åˆç±»å‹ï¼ˆCompound typesï¼‰`å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰`ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹`ï¼š
- å…ƒç»„ï¼ˆtupleï¼‰
- æ•°ç»„ï¼ˆarrayï¼‰

#### å…ƒç»„ç±»å‹

å…ƒç»„æ˜¯ä¸€ä¸ªå°†å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ã€‚

å…ƒç»„`é•¿åº¦å›ºå®š`ï¼šä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°ã€‚

```rust
fn main() {
    let tup = (500, 6.4, 1);
    // let tup: (i32, f64, u8) = (500, 6.4, 1);

    let (x, y, z) = tup; // æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰æ¥è§£æ„ï¼ˆdestructureï¼‰å…ƒç»„å€¼

    println!("The value of y is: {y}");

    // æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç‚¹å·ï¼ˆ.ï¼‰åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬ã€‚
    let five_hundred = x.0;

    let six_point_four = x.1;

    let one = x.2;
}
```
è®¿é—®å…ƒç»„å…ƒç´ ï¼š
- æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰æ¥è§£æ„ï¼ˆdestructureï¼‰å…ƒç»„å€¼
- ä½¿ç”¨`ç‚¹å·ï¼ˆ.ï¼‰`åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬ã€‚

#### æ•°ç»„ç±»å‹

å¦ä¸€ä¸ªåŒ…å«å¤šä¸ªå€¼çš„æ–¹å¼æ˜¯ æ•°ç»„ï¼ˆarrayï¼‰: 
- æ•°ç»„ä¸­çš„`æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ`ã€‚
- æ•°ç»„`é•¿åº¦æ˜¯å›ºå®š`çš„ã€‚

```rust
fn main() {
    let a = [1, 2, 3, 4, 5];

    // åœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡
    let a: [i32; 5] = [1, 2, 3, 4, 5];

    // åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼åŠ åˆ†å·å†åŠ å…ƒç´ ä¸ªæ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªæ¯ä¸ªå…ƒç´ éƒ½ä¸ºç›¸åŒå€¼çš„æ•°ç»„
    // let a = [3, 3, 3, 3, 3]; æ•ˆæœç›¸åŒ
    let a = [3; 5];

}

```

#### è®¿é—®æ•°ç»„å…ƒç´ 
```rust
fn main() {
    let a = [1, 2, 3, 4, 5];

    // ç´¢å¼•è®¿é—®
    let first = a[0];
    let second = a[1];
}
```
> è®¿é—®è¶Šç•Œ: å¦‚æœæˆ‘ä»¬è®¿é—®æ•°ç»„ç»“å°¾ä¹‹åçš„å…ƒç´ æ—¶ï¼Œå¯¼è‡´ `è¿è¡Œæ—¶ é”™è¯¯(panic)`ã€‚ç¨‹åºå¸¦ç€é”™è¯¯ä¿¡æ¯é€€å‡º


## 3.2 å‡½æ•°

å‡½æ•°æ‹¥æœ‰ `å‚æ•°ï¼ˆparametersï¼‰ï¼ˆå½¢å‚ï¼‰`çš„å‡½æ•°ï¼Œå‚æ•°æ˜¯ç‰¹æ®Šå˜é‡ï¼Œæ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†
ä¸ºè¿™äº›å‚æ•°æä¾›å…·ä½“çš„`å€¼ï¼ˆå®å‚ï¼‰`ã€‚æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›å…·ä½“å€¼è¢«ç§°ä¸ºå‚æ•°ï¼ˆargumentsï¼‰ï¼Œ


åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ`å¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹`ã€‚è¿™æ˜¯ Rust è®¾è®¡ä¸­ä¸€ä¸ªç»è¿‡æ…é‡è€ƒè™‘çš„å†³å®šï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ç±»å‹æ³¨è§£ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨å†ä¹Ÿä¸éœ€è¦ä½ åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹æ³¨æ˜ç±»å‹æ¥æŒ‡å‡ºä½ çš„æ„å›¾ã€‚

### 

`è¯­å¥ï¼ˆStatementsï¼‰`æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤:
- `let y = 6;` æ˜¯ä¸€ä¸ªè¯­å¥ã€‚
- `è¯­å¥`ä¸è¿”å›å€¼ã€‚å› æ­¤ï¼Œä¸èƒ½æŠŠ let è¯­å¥èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡

`è¡¨è¾¾å¼ï¼ˆExpressionsï¼‰`è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼:
- è¯­å¥ `let y = 6; `ä¸­çš„ `6` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼
- ç”¨å¤§æ‹¬å·åˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š
   ```rust
   let y = {
        let x = 3;

        // æ³¨æ„ x+1 è¿™ä¸€è¡Œåœ¨ç»“å°¾æ²¡æœ‰åˆ†å·ï¼Œä¸ä½ è§è¿‡çš„å¤§éƒ¨åˆ†ä»£ç è¡Œä¸åŒã€‚
        // å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼
        x + 1 
    };
   ```
   yçš„å€¼æ˜¯ 4



### å…·æœ‰è¿”å›å€¼çš„å‡½æ•°

åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“`æœ€åä¸€ä¸ªè¡¨è¾¾å¼`çš„å€¼ã€‚
```rust
fn five() -> i32 {
    5
}
```

ä½¿ç”¨ `return` å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›

> ç”¨æœ€åä¸€ä¸ªè¡¨è¾¾å¼è¿”å›å€¼æ—¶ä¸è¦åŠ `åˆ†å·`


## 3.4 æ³¨é‡Š

ç”¨åŒæ–œæ ` // `æ³¨é‡Š Rust ä»£ç 

æ–‡æ¡£æ³¨é‡Šä½¿ç”¨ä¸‰æ–œæ  `///` è€Œä»¥æ”¯æŒ Markdown æ³¨è§£æ¥æ ¼å¼åŒ–æ–‡æœ¬ã€‚
```rust 
/// Adds one to the number given.
///
/// # Examples
///
/// ```
/// let arg = 5;
/// let answer = my_crate::add_one(arg);
///
/// assert_eq!(6, answer);
/// ```
pub fn add_one(x: i32) -> i32 {
    x + 1
}
```


## 3.5 æ§åˆ¶æµ

### if

```rust
fn main() {
    let number = 3;

    if number < 5 {
        println!("condition was true");
    } else {
        println!("condition was false");
    }
}
```
> ä¸åƒ Ruby æˆ– JavaScript è¿™æ ·çš„è¯­è¨€ï¼ŒRust å¹¶ä¸ä¼šå°è¯•è‡ªåŠ¨åœ°å°†éå¸ƒå°”å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚å¿…é¡»æ€»æ˜¯`æ˜¾å¼åœ°ä½¿ç”¨å¸ƒå°”å€¼`ä½œä¸º if çš„æ¡ä»¶ã€‚


### else if
```rust
fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3");
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3, or 2");
    }

    // åœ¨ let è¯­å¥ä¸­ä½¿ç”¨ if
    let number = if condition { 5 } else { 6 };
}
```
> ä½¿ç”¨è¿‡å¤šçš„ else if è¡¨è¾¾å¼ä¼šä½¿ä»£ç æ˜¾å¾—æ‚ä¹±æ— ç« ï¼Œæ‰€ä»¥å¦‚æœæœ‰å¤šäºä¸€ä¸ª else if è¡¨è¾¾å¼ï¼Œæœ€å¥½é‡æ„ä»£ç ã€‚ä¸ºæ­¤ï¼Œç¬¬å…­ç« ä¼šä»‹ç»ä¸€ä¸ªå¼ºå¤§çš„ Rust åˆ†æ”¯ç»“æ„ï¼ˆbranching constructï¼‰ï¼Œå«åš `match`ã€‚


### loopã€while å’Œ for
#### loop
```rust
// loop
fn main() {
    let mut counter = 0;
    
    // èµ‹å€¼ç»™ result 
    let result = loop {
        counter += 1;

        if counter == 10 {
            // ä½¿ç”¨ break å…³é”®å­—è¿”å›å€¼ counter * 2
            break counter * 2;
        }
    };

    println!("The result is {result}");
}
```
#### å¾ªç¯æ ‡ç­¾ï¼šåœ¨å¤šä¸ªå¾ªç¯ä¹‹é—´æ¶ˆé™¤æ­§ä¹‰
å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œbreak å’Œ continue åº”ç”¨äºæ­¤æ—¶`æœ€å†…å±‚çš„å¾ªç¯`ã€‚
ä½ å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªå¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ª `å¾ªç¯æ ‡ç­¾ï¼ˆloop labelï¼‰`ï¼Œç„¶åå°†æ ‡ç­¾ä¸ break æˆ– continue ä¸€èµ·ä½¿ç”¨ï¼Œä½¿è¿™äº›å…³é”®å­—åº”ç”¨äºå·²æ ‡è®°çš„å¾ªç¯è€Œä¸æ˜¯æœ€å†…å±‚çš„å¾ªç¯ã€‚

```rust
// loop
fn main() {
    let mut count = 0;

    // æ ‡ç­¾ counting_up
    'counting_up: loop {
        println!("count = {count}");
        let mut remaining = 10;

        loop {
            println!("remaining = {remaining}");
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }
    println!("End count = {count}");
}
```


#### while
```rust
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{number}!");

        number -= 1;
    }

    println!("LIFTOFF!!!");
}
```


#### for
```rust
fn main() {
    let a = [10, 20, 30, 40, 50];

    for element in a {
        println!("the value is: {element}");
    }

    // ä½¿ç”¨ for å¾ªç¯æ¥å€’è®¡æ—¶
    // revï¼Œç”¨æ¥åè½¬ range
    for number in (1..4).rev() {
        println!("{number}!");
    }
    println!("LIFTOFF!!!");
}
```

# 4. Understanding Ownership
æ‰€æœ‰æƒï¼ˆç³»ç»Ÿï¼‰æ˜¯ Rust æœ€ä¸ºä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼Œå¯¹è¯­è¨€çš„å…¶ä»–éƒ¨åˆ†æœ‰ç€æ·±åˆ»å«ä¹‰ã€‚å®ƒè®© Rust æ— éœ€åƒåœ¾å›æ”¶ï¼ˆgarbage collectorï¼‰å³å¯ä¿éšœå†…å­˜å®‰å…¨.

## 4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒï¼Ÿ
> Rust åˆ™é€‰æ‹©äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿç®¡ç†å†…å­˜ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœè¿åäº†ä»»ä½•è¿™äº›è§„åˆ™ï¼Œç¨‹åºéƒ½ä¸èƒ½ç¼–è¯‘ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒç³»ç»Ÿçš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå‡æ…¢ç¨‹åºã€‚

åœ¨åƒ Rust è¿™æ ·çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­ï¼Œ`å€¼æ˜¯ä½äºæ ˆä¸Šè¿˜æ˜¯å †ä¸Š`åœ¨æ›´å¤§ç¨‹åº¦ä¸Šå½±å“äº†è¯­è¨€çš„è¡Œä¸ºä»¥åŠä¸ºä½•å¿…é¡»åšå‡ºè¿™æ ·çš„æŠ‰æ‹©ã€‚

æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šçš„å¤§å°ã€‚

å¤§å°æœªçŸ¥æˆ–å¤§å°å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œè¦æ”¹ä¸ºå­˜å‚¨åœ¨å †ä¸Šã€‚ å †æ˜¯ç¼ºä¹ç»„ç»‡çš„ï¼šå½“å‘å †æ”¾å…¥æ•°æ®æ—¶ï¼Œä½ è¦è¯·æ±‚ä¸€å®šå¤§å°çš„ç©ºé—´ã€‚

å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºï¼ˆå…¥æ ˆæ—¶ï¼‰åˆ†é…å™¨æ— éœ€ä¸ºå­˜å‚¨æ–°æ•°æ®å»æœç´¢å†…å­˜ç©ºé—´. å…¶ä½ç½®æ€»æ˜¯åœ¨æ ˆé¡¶

è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­è·³è½¬è¶Šå°‘å°±è¶Šå¿«ï¼ˆç¼“å­˜ï¼‰ã€‚

> è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®çš„æ•°é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚


### æ‰€æœ‰æƒè§„åˆ™
- Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª æ‰€æœ‰è€…ï¼ˆownerï¼‰ã€‚
- å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
- å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚


### å˜é‡ä½œç”¨åŸŸ
```rust
    {                      // s åœ¨è¿™é‡Œæ— æ•ˆï¼Œå®ƒå°šæœªå£°æ˜
        let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„

        // ä½¿ç”¨ s
    }                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ
```


### æ¼”ç¤ºæ‰€æœ‰æƒçš„è§„åˆ™ - String ç±»å‹

æˆ‘ä»¬å·²ç»è§è¿‡`å­—ç¬¦ä¸²å­—é¢å€¼(String literals)`ï¼Œå³è¢«ç¡¬ç¼–ç è¿›ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²å€¼ã€‚ å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä¸è¿‡å®ƒä»¬å¹¶ä¸é€‚åˆä½¿ç”¨æ–‡æœ¬çš„æ¯ä¸€ç§åœºæ™¯ã€‚
- åŸå› ä¹‹ä¸€å°±æ˜¯`å®ƒä»¬æ˜¯ä¸å¯å˜çš„`ã€‚
- å¦ä¸€ä¸ªåŸå› æ˜¯å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–å†™ä»£ç æ—¶å°±çŸ¥é“ï¼šä¾‹å¦‚ï¼Œè¦æ˜¯æƒ³è·å–ç”¨æˆ·è¾“å…¥å¹¶å­˜å‚¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

> ä¸ºæ­¤ï¼ŒRust æœ‰ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œ`String`ã€‚è¿™ä¸ªç±»å‹ç®¡ç†è¢«åˆ†é…åˆ°å †ä¸Šçš„æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„æ–‡æœ¬ã€‚

```rust
    // ä½¿ç”¨ from å‡½æ•°åŸºäºå­—ç¬¦ä¸²å­—é¢å€¼æ¥åˆ›å»º String
    let mut s = String::from("hello");

    // String å¯ä»¥ä¿®æ”¹
    s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼

    println!("{}", s); // å°†æ‰“å° `hello, world!`
```

å¯¹äº `String` ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ª`å¯å˜ï¼Œå¯å¢é•¿`çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š
- å¿…é¡»åœ¨`è¿è¡Œæ—¶`å‘å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚
- éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ `String` æ—¶å°†ä¸å†ä½¿ç”¨çš„å†…å­˜è¿”è¿˜ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚

> Rust é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„ç­–ç•¥ï¼šå†…å­˜åœ¨`æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸå`å°±è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚

å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš `drop` ï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„` } `å¤„è‡ªåŠ¨è°ƒç”¨ `drop` ã€‚


### å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨

```rust
    let s1 = String::from("hello");
    let s2 = s1;
```
æŒ‡é’ˆs1å’Œs2åŒæ—¶æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæ˜¯ `æµ…æ‹·è´`ã€‚
è¿™å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“ s2 å’Œ s1 ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš `äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰`çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯ä¹‹å‰æåˆ°è¿‡çš„å†…å­˜å®‰å…¨æ€§ bug ä¹‹ä¸€ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œåœ¨ let s2 = s1; ä¹‹åï¼ŒRust `è®¤ä¸º s1 ä¸å†æœ‰æ•ˆ`ï¼Œå› æ­¤ Rust ä¸éœ€è¦åœ¨ s1 ç¦»å¼€ä½œç”¨åŸŸåæ¸…ç†ä»»ä½•ä¸œè¥¿ã€‚

å› è€Œåœ¨ s2 è¢«åˆ›å»ºä¹‹åå°è¯•ä½¿ç”¨ s1 ä¼šå‘ç”Ÿï¼š`error[E0382]: borrow of moved value: s1`

> å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ `æµ…æ‹·è´ï¼ˆshallow copyï¼‰`å’Œ `æ·±æ‹·è´ï¼ˆdeep copyï¼‰`ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¯èƒ½å¬èµ·æ¥åƒæµ…æ‹·è´ã€‚`ä¸è¿‡å› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡æ— æ•ˆäº†`ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸º `ç§»åŠ¨ï¼ˆmoveï¼‰`ï¼Œè€Œä¸æ˜¯å«åšæµ…æ‹·è´ã€‚

> è¿™é‡Œè¿˜éšå«äº†ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼š`Rust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€`ã€‚å› æ­¤ï¼Œå¯ä»¥å‡å®šä»»ä½•è‡ªåŠ¨å¤åˆ¶åœ¨è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢éƒ½æ˜¯å»‰ä»·çš„ã€‚


### å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆäºŒï¼‰ï¼šå…‹éš†
å¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦ `æ·±åº¦å¤åˆ¶` String ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš `clone` çš„é€šç”¨å‡½æ•°ã€‚
```rust
    let s1 = String::from("hello");
    let s2 = s1.clone();

    println!("s1 = {}, s2 = {}", s1, s2);
```

#### åªåœ¨æ ˆä¸Šçš„æ•°æ®ï¼šæ‹·è´
```rust
    let x = 5;
    let y = x;

    println!("x = {}, y = {}", x, y);
```

åƒ`æ•´å‹`è¿™æ ·çš„åœ¨ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°çš„ç±»å‹è¢«æ•´ä¸ªå­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æ‹·è´å…¶å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ y åä½¿ x æ— æ•ˆã€‚


#### Trait: Copy
Rust æœ‰ä¸€ä¸ªå«åš `Copy` trait çš„ç‰¹æ®Šæ³¨è§£ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·çš„`å­˜å‚¨åœ¨æ ˆä¸Šçš„ç±»å‹`ä¸Š.
å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† `Copy` traitï¼Œé‚£ä¹ˆä¸€ä¸ªæ—§çš„å˜é‡åœ¨å°†å…¶èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚
Rust ä¸å…è®¸è‡ªèº«æˆ–å…¶ä»»ä½•éƒ¨åˆ†å®ç°äº† `Drop` trait çš„ç±»å‹ä½¿ç”¨ `Copy` traitã€‚

ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼Œä»»ä½•ä¸€ç»„`ç®€å•æ ‡é‡å€¼çš„ç»„åˆ`éƒ½å¯ä»¥å®ç° `Copy` ï¼Œ
ä»»ä½•`ä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹`éƒ½å¯ä»¥å®ç° `Copy` ã€‚


#### æ‰€æœ‰æƒä¸å‡½æ•°

å°†å€¼ä¼ é€’ç»™å‡½æ•°ä¸ç»™å˜é‡èµ‹å€¼çš„åŸç†ç›¸ä¼¼ã€‚
```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

    makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                    // ä½† i32 æ˜¯ Copy çš„ï¼Œ
                                    // æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œï¼Œx å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚
  // å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„
```

å½“å°è¯•åœ¨è°ƒç”¨ `takes_ownership` åä½¿ç”¨ `s` æ—¶ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚


#### è¿”å›å€¼ä¸ä½œç”¨åŸŸ

> è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒã€‚å˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼šå°†å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ç§»åŠ¨å®ƒã€‚å½“æŒæœ‰å †ä¸­æ•°æ®å€¼çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå…¶å€¼å°†é€šè¿‡ drop è¢«æ¸…ç†æ‰ï¼Œé™¤éæ•°æ®è¢«ç§»åŠ¨ä¸ºå¦ä¸€ä¸ªå˜é‡æ‰€æœ‰ã€‚

```rust
fn main() {
    let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                        // è½¬ç§»ç»™ s1

    let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ

    let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°takes_and_gives_back ä¸­, å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3                                 
    // takes_and_gives_backè¿”å›ås2å³è¢«drop


} // è¿™é‡Œï¼Œs3ï¼Œs1ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚

fn gives_ownership() -> String {

    let some_string = String::from("yours");
    some_string
}

fn takes_and_gives_back(a_string: String) -> String {
    a_string
}
```

åœ¨æ¯ä¸€ä¸ªå‡½æ•°ä¸­éƒ½è·å–æ‰€æœ‰æƒå¹¶æ¥ç€è¿”å›æ‰€æœ‰æƒæœ‰äº›å•°å—¦ã€‚
å¦‚æœæˆ‘ä»¬æƒ³è¦å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå€¼ä½†ä¸è·å–æ‰€æœ‰æƒè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬è¿˜è¦æ¥ç€ä½¿ç”¨å®ƒçš„è¯ï¼Œæ¯æ¬¡éƒ½ä¼ è¿›å»å†è¿”å›æ¥å°±æœ‰ç‚¹çƒ¦äººäº†.
-> Rust å¯¹æ­¤æä¾›äº†ä¸€ä¸ªä¸ç”¨è·å–æ‰€æœ‰æƒå°±å¯ä»¥ä½¿ç”¨å€¼çš„åŠŸèƒ½ï¼Œå«åš `å¼•ç”¨ï¼ˆreferencesï¼‰`

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½æƒ³è¿”å›å‡½æ•°ä½“ä¸­äº§ç”Ÿçš„ä¸€äº›æ•°æ®ã€‚
-> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`å…ƒç»„`æ¥è¿”å›å¤šä¸ªå€¼


## 4.2 å¼•ç”¨ä¸å€Ÿç”¨
```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    // calculate_lengthå®Œæˆåå¹¶ä¸ä¼šdrop s1
    println!("The length of '{}' is {}.", s1, len);
}

// s æ˜¯ String çš„å¼•ç”¨
fn calculate_length(s: &String) -> usize {
    s.len()
}
// å½“ s åœæ­¢ä½¿ç”¨æ—¶å¹¶ä¸ä¸¢å¼ƒå¼•ç”¨æŒ‡å‘çš„æ•°æ®ï¼Œå› ä¸º s å¹¶æ²¡æœ‰æ‰€æœ‰æƒã€‚
```

`&s1 `è¯­æ³•è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `æŒ‡å‘ å€¼ s1 `çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚
å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥å½“å¼•ç”¨åœæ­¢ä½¿ç”¨æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚

#### å°è¯•ä¿®æ”¹å€Ÿç”¨çš„å˜é‡
```rust
fn main() {
    let s = String::from("hello");

    change(&s);
}

fn change(some_string: &String) {
    some_string.push_str(", world");
}
```
> è¯•å›¾ä¿®æ”¹å¼•ç”¨çš„å‚æ•°ä¼šæŠ¥é”™ï¼šerror[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference

### å¯å˜å¼•ç”¨
é€šè¿‡ä¸€ä¸ªå°è°ƒæ•´å°±èƒ½å…è®¸æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå€Ÿç”¨çš„å€¼,`å¯å˜å¼•ç”¨ï¼ˆmutable referenceï¼‰`ï¼š
- æˆ‘ä»¬å¿…é¡»å°† `s` æ”¹ä¸º `mut`ã€‚
- ç„¶ååœ¨è°ƒç”¨ change å‡½æ•°çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ªå¯å˜å¼•ç”¨ `&mut s`
- å¹¶æ›´æ–°å‡½æ•°ç­¾åä»¥æ¥å—ä¸€ä¸ªå¯å˜å¼•ç”¨ `some_string: &mut String`

```rust
fn main() {
    let mut s = String::from("hello");

    change(&mut s);
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```
å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼š
- å¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è¯¥å˜é‡çš„å¯å˜å¼•ç”¨ï¼Œåœ¨è¿™ä¸ªå¯å˜å¼•ç”¨ä¸å†ä½¿ç”¨å‰ï¼Œä½ ä¸èƒ½å†åˆ›å»ºå¦ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚
- æˆ‘ä»¬ ä¹Ÿ ä¸èƒ½åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„åŒæ—¶æ‹¥æœ‰å¯å˜å¼•ç”¨ã€‚
> å°è¯•åˆ›å»ºä¸¤ä¸ª s çš„å¯å˜å¼•ç”¨çš„ä»£ç ä¼šå¤±è´¥: error[E0499]: cannot borrow `s` as mutable more than once at a time

è¿™ä¸€é™åˆ¶ä»¥ä¸€ç§éå¸¸å°å¿ƒè°¨æ…çš„æ–¹å¼å…è®¸å¯å˜æ€§ï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¯¹åŒä¸€æ•°æ®å­˜åœ¨å¤šä¸ªå¯å˜å¼•ç”¨ã€‚
è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…`æ•°æ®ç«äº‰`ã€‚

> æ³¨æ„ä¸€ä¸ªå¼•ç”¨çš„ä½œç”¨åŸŸä»å£°æ˜çš„åœ°æ–¹å¼€å§‹ä¸€ç›´`æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨ä¸ºæ­¢`ã€‚



### æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referencesï¼‰
åœ¨å…·æœ‰æŒ‡é’ˆçš„è¯­è¨€ä¸­ï¼Œå¾ˆå®¹æ˜“é€šè¿‡é‡Šæ”¾å†…å­˜æ—¶ä¿ç•™æŒ‡å‘å®ƒçš„æŒ‡é’ˆè€Œé”™è¯¯åœ°ç”Ÿæˆä¸€ä¸ª `æ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰`ï¼Œæ‰€è°“æ‚¬å‚æŒ‡é’ˆæ˜¯`å…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½å·²ç»è¢«åˆ†é…ç»™å…¶å®ƒæŒæœ‰è€…`ã€‚

> ä¸‹è¿°ä»£ç ä¼šæŠ¥é”™ï¼šerror[E0106]: missing lifetime specifier

```rust
fn main() {
    let reference_to_nothing = dangle();
}


// è¿”å›ä¸€ä¸ªStringçš„å¼•ç”¨
fn dangle() -> &String {
    let s = String::from("hello");

    &s
    // é¢„æœŸè¿”å›sçš„å¼•ç”¨ï¼Œä½†æ³¨æ„æ­¤å‡½æ•°å®Œæˆåsæœ¬èº«ä¼šè¢«dropï¼Œå› è€Œè¿”å›çš„å¼•ç”¨æŒ‡å‘null
}
```


## 4.3 Slice ç±»å‹

`slice` å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚
`slice` æ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚

> usize æ˜¯ Rust ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ç§æ•´æ•°ç±»å‹ï¼Œå®ƒä»£è¡¨æ— ç¬¦å·æ•´æ•°ã€‚
> å®ƒçš„å¤§å°å–å†³äºè¿è¡Œ Rust ä»£ç çš„è®¡ç®—æœºæ¶æ„ï¼Œé€šå¸¸æ˜¯ä¸è®¡ç®—æœºçš„æŒ‡é’ˆå¤§å°ç›¸åŒã€‚åœ¨ 32 ä½è®¡ç®—æœºä¸Šï¼Œusize æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œè€Œåœ¨ 64 ä½è®¡ç®—æœºä¸Šï¼Œusize æ˜¯ 64 ä½æ— ç¬¦å·æ•´æ•°ã€‚


#### '' å’Œ b''
æ³¨æ„ï¼š' ' æ˜¯ Rust ä¸­çš„ char å­—é¢å€¼ï¼Œå®ƒå¯ä»¥åŒ…å«å•ä¸ªå­—ç¬¦ï¼Œ
è€Œ b' ' æ˜¯å­—èŠ‚å­—é¢å€¼ï¼ŒåªåŒ…å«ä¸€ä¸ªå­—èŠ‚ã€‚
åœ¨ Rust ä¸­ï¼Œå­—ç¬¦å­—é¢å€¼é€šå¸¸ç”¨äºè¡¨ç¤ºæ–‡æœ¬å­—ç¬¦ï¼Œè€Œå­—èŠ‚å­—é¢å€¼ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚


#### &str å’Œ String 
`&strï¼š` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œå®ƒæ˜¯ä¸€ä¸ª`ä¸å¯å˜å¼•ç”¨ï¼ˆimmutable referenceï¼‰`ï¼Œé€šå¸¸ç”¨äºå¼•ç”¨å­—ç¬¦ä¸²æ–‡æœ¬çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ä»ä¸€ä¸ª String æˆ–å­—ç¬¦ä¸²å­—é¢å€¼ä¸­æå–çš„å­ä¸²ã€‚ç”±äº str æ˜¯ä¸å¯å˜çš„ï¼Œä½ ä¸èƒ½å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚str ç±»å‹é€šå¸¸ç”¨äºå‚æ•°ä¼ é€’å’Œå­—ç¬¦ä¸²å¤„ç†çš„å¼•ç”¨å½¢å¼ã€‚

`Stringï¼š`æ˜¯ Rust çš„æ ‡å‡†åº“ä¸­æä¾›çš„å¯å˜çš„ã€æ‹¥æœ‰ï¼ˆownedï¼‰çš„å­—ç¬¦ä¸²ç±»å‹ã€‚å®ƒæ˜¯ä¸€ä¸ªå †åˆ†é…çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥éšæ—¶è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹æ“ä½œã€‚String é€šå¸¸ç”¨äºéœ€è¦åŠ¨æ€åˆ†é…å’Œä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹çš„æƒ…å†µã€‚

> å½“ç¼–å†™å‡½æ•°çš„å…¥å‚ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæœ€å¥½è®©å…¶ç±»å‹ä¸º`&str`ï¼Œå¦‚æœæœ‰ä¸€ä¸ª Stringï¼Œåˆ™å¯ä»¥ä¼ é€’æ•´ä¸ª String çš„ slice æˆ–å¯¹ String çš„å¼•ç”¨ã€‚
> å®šä¹‰ä¸€ä¸ªè·å– `&str` è€Œä¸æ˜¯ String å¼•ç”¨çš„å‡½æ•°ä½¿å¾—æˆ‘ä»¬çš„ API æ›´åŠ é€šç”¨å¹¶ä¸”ä¸ä¼šä¸¢å¤±ä»»ä½•åŠŸèƒ½ï¼š


### å…¶ä»–ç±»å‹çš„ slice
```rust
let a = [1, 2, 3, 4, 5];

let slice = &a[1..3]; // data type of slice: &[i32]

assert_eq!(slice, &[2, 3]);
```


# 5. `Structs` to Structure Related Data
structæˆ–structureæ˜¯ä¸€ç§è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå…è®¸æ‚¨å°†å¤šä¸ªç›¸å…³çš„å€¼æ‰“åŒ…åœ¨ä¸€èµ·å¹¶å‘½åï¼Œè¿™äº›å€¼ç»„æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„ç»„ã€‚
å¦‚æœæ‚¨ç†Ÿæ‚‰é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œ `struct` å°±åƒå¯¹è±¡çš„æ•°æ®å±æ€§ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒå’Œå¯¹æ¯” `tuple` å’Œ `struct` ï¼Œä»¥å»ºç«‹åœ¨æ‚¨å·²ç»çŸ¥é“çš„åŸºç¡€ä¸Šï¼Œå¹¶æ¼”ç¤º `struct` æ˜¯åˆ†ç»„æ•°æ®çš„æ›´å¥½æ–¹æ³•ã€‚

æˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•å®šä¹‰å’Œå®ä¾‹åŒ– `struct` ã€‚æˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•å®šä¹‰å…³è”å‡½æ•°ï¼Œç‰¹åˆ«æ˜¯ç§°ä¸ºæ–¹æ³•çš„å…³è”å‡½æ•°ï¼Œä»¥æŒ‡å®šä¸ `struct` ç±»å‹å…³è”çš„è¡Œä¸ºã€‚ `Structs` å’Œ `Enum` (åœ¨ç¬¬6ç« ä¸­è®¨è®º)æ˜¯åœ¨ç¨‹åºåŸŸä¸­åˆ›å»ºæ–°ç±»å‹ä»¥å……åˆ†åˆ©ç”¨Rustçš„ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥çš„æ„å»ºå—ã€‚

## 5.1 ç»“æ„ä½“çš„å®šä¹‰å’Œå®ä¾‹åŒ–

```rust
// Def
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
```
> ç»“æ„ä½“æ•°æ®çš„æ‰€æœ‰æƒ: æˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ String ç±»å‹è€Œä¸æ˜¯ &str å­—ç¬¦ä¸² slice ç±»å‹ã€‚
> è¿™æ˜¯ä¸€ä¸ªæœ‰æ„è€Œä¸ºä¹‹çš„é€‰æ‹©ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦è¿™ä¸ªç»“æ„ä½“`æ‹¥æœ‰å®ƒæ‰€æœ‰çš„æ•°æ®`ï¼Œä¸ºæ­¤åªè¦æ•´ä¸ªç»“æ„ä½“æ˜¯æœ‰æ•ˆçš„è¯å…¶æ•°æ®ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚
> è¦ä½¿ç»“æ„ä½“å­˜å‚¨`è¢«å…¶ä»–å¯¹è±¡æ‹¥æœ‰çš„æ•°æ®çš„å¼•ç”¨`, éœ€è¦ç”¨ä¸Š `ç”Ÿå‘½å‘¨æœŸï¼ˆlifetimesï¼‰`

#### è®¿é—®å’Œä¿®æ”¹å±æ€§
æ³¨æ„æ•´ä¸ªå®ä¾‹å¿…é¡»æ˜¯å¯å˜çš„ï¼›Rust å¹¶ä¸å…è®¸åªå°†æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜

```rust
fn main() {
    // Initialize an instance
    let mut user1 = User {
        active: true,
        username: String::from("someusername123"),
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    };

    // Access attribute with `.`
    // Modify attribute requires struct to be mutable
    user1.email = String::from("anotheremail@example.com");
}
```

#### Builder
```rust
fn build_user(email: String, username: String) -> User {
    User {
        active: true,
        username: username,
        email: email,
        sign_in_count: 1,
    }
}

// ä¸ºå‡½æ•°å‚æ•°èµ·ä¸ç»“æ„ä½“å­—æ®µç›¸åŒçš„åå­—æ˜¯å¯ä»¥ç†è§£çš„ï¼Œä½†æ˜¯ä¸å¾—ä¸é‡å¤ email å’Œ username å­—æ®µåç§°ä¸å˜é‡æœ‰äº›å•°å—¦ã€‚
// å¦‚æœç»“æ„ä½“æœ‰æ›´å¤šå­—æ®µï¼Œé‡å¤æ¯ä¸ªåç§°å°±æ›´åŠ çƒ¦äººäº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ç®€å†™è¯­æ³•ï¼
fn build_user_compact(email: String, username: String) -> User {
    User {
        active: true,
        // ä½¿ç”¨äº†å­—æ®µåˆå§‹åŒ–ç®€å†™è¯­æ³•ï¼Œå› ä¸º username å’Œ email å‚æ•°ä¸ç»“æ„ä½“å­—æ®µåŒå
        username,
        email,
        sign_in_count: 1,
    }
}
```

### ä½¿ç”¨`ç»“æ„ä½“æ›´æ–°`è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹

`ä½¿ç”¨æ—§å®ä¾‹çš„å¤§éƒ¨åˆ†å€¼`ä½†`æ”¹å˜å…¶éƒ¨åˆ†å€¼`æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“æ„ä½“å®ä¾‹é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™å¯ä»¥é€šè¿‡ `ç»“æ„ä½“æ›´æ–°è¯­æ³•ï¼ˆstruct update syntaxï¼‰`å®ç°ã€‚

é€šè¿‡ `..` è¯­æ³•æŒ‡å®šäº†å‰©ä½™æœªæ˜¾å¼è®¾ç½®å€¼çš„å­—æ®µåº”æœ‰ä¸ç»™å®šå®ä¾‹å¯¹åº”å­—æ®µç›¸åŒçš„å€¼ã€‚

```rust
fn main() {
    let user2 = User {
        // ä½¿ç”¨user1å®ä¾‹çš„å±æ€§
        active: user1.active,
        username: user1.username,
        email: String::from("another@example.com"),
        sign_in_count: user1.sign_in_count,    
    };
}

// `..` è¯­æ³•è¿›ä¸€æ­¥å‡çœ
    let user2 = User {
        email: String::from("another@example.com"),
        ..user1
        // ..user1 å¿…é¡»æ”¾åœ¨æœ€å
    };

```
> è¯·æ³¨æ„ï¼Œ`ç»“æ„æ›´æ–°è¯­æ³•`å°±åƒå¸¦æœ‰ = çš„èµ‹å€¼ï¼Œå› ä¸ºå®ƒ`ç§»åŠ¨`äº†æ•°æ®
> æ€»ä½“ä¸Šè¯´æˆ‘ä»¬åœ¨åˆ›å»º user2 åä¸èƒ½å°±å†ä½¿ç”¨ user1 äº†ï¼Œå› ä¸º user1 çš„ username å­—æ®µä¸­çš„ String è¢«ç§»åˆ° user2 ä¸­.
> ä½†å¦‚æœ`æ›´æ–°çš„å­—æ®µéƒ½æ˜¯åŸºç¡€ç±»å‹`å¦‚boolå’Œi32ï¼Œæ˜¯`å®ç° Copy trait çš„ç±»å‹`ã€‚é‚£ä¹ˆ user1 åœ¨åˆ›å»º user2 åä»ç„¶æœ‰æ•ˆ


### å…ƒç»„ç»“æ„ä½“ï¼ˆtuple structsï¼‰

å…ƒç»„ç»“æ„ä½“`æœ‰ç€ç»“æ„ä½“åç§°`æä¾›çš„å«ä¹‰ï¼Œä½†`æ²¡æœ‰å…·ä½“çš„å­—æ®µå`ï¼Œåªæœ‰å­—æ®µçš„ç±»å‹ã€‚

è™½ç„¶Colorï¼ŒPointä¸¤ä¸ªç±»å‹éƒ½ç”±ä¸‰ä¸ª i32 å€¼ç»„æˆï¼Œä½†blackï¼Œoriginæ˜¯ä¸åŒçš„å…ƒç»„ç»“æ„ä½“çš„å®ä¾‹

å…ƒç»„ç»“æ„ä½“å®ä¾‹ç±»ä¼¼äºå…ƒç»„ï¼Œä½ å¯ä»¥å°†å®ƒä»¬`è§£æ„ä¸ºå•ç‹¬çš„éƒ¨åˆ†`ï¼Œä¹Ÿ`å¯ä»¥ä½¿ç”¨ . åè·Ÿç´¢å¼•æ¥è®¿é—®å•ç‹¬çš„å€¼`ï¼Œç­‰ç­‰ã€‚

```rust
struct Color(i32, i32, i32);
struct Point(i32, i32, i32);

fn main() {
    let black = Color(0, 0, 0);
    let origin = Point(0, 0, 0);
}
```
### ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰

æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼å®ƒä»¬è¢«ç§°ä¸º ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰

ç±»å•å…ƒç»“æ„ä½“å¸¸å¸¸åœ¨ä½ æƒ³è¦`åœ¨æŸä¸ªç±»å‹ä¸Šå®ç° trait ä½†ä¸éœ€è¦åœ¨ç±»å‹ä¸­å­˜å‚¨æ•°æ®çš„æ—¶å€™`å‘æŒ¥ä½œç”¨

```rust
struct AlwaysEqual;

fn main() {
    let subject = AlwaysEqual;
}
```


## 5.2 ç»“æ„ä½“ç¤ºä¾‹ç¨‹åº
```rust
struct Rectangle {
    width: u32,
    height: u32,
}

fn area(rectangle: Rectangle) -> u32 {
    rectangle.height * rectangle.width
}

pub(crate) fn main() {

    let rectangle = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        area(rectangle)
    );
}
```

### é€šè¿‡æ´¾ç”Ÿ trait å¢åŠ å®ç”¨åŠŸèƒ½
`println! `å®èƒ½å¤„ç†å¾ˆå¤šç±»å‹çš„æ ¼å¼ï¼Œä¸è¿‡ï¼Œ`{}` é»˜è®¤å‘Šè¯‰ `println! `ä½¿ç”¨è¢«ç§°ä¸º Display çš„æ ¼å¼ï¼šæ„åœ¨æä¾›ç»™ç›´æ¥ç»ˆç«¯ç”¨æˆ·æŸ¥çœ‹çš„è¾“å‡ºã€‚

ç›®å‰ä¸ºæ­¢è§è¿‡çš„åŸºæœ¬ç±»å‹éƒ½é»˜è®¤å®ç°äº† `Display` ï¼Œå› ä¸ºå®ƒå°±æ˜¯å‘ç”¨æˆ·å±•ç¤º 1 æˆ–å…¶ä»–ä»»ä½•åŸºæœ¬ç±»å‹çš„å”¯ä¸€æ–¹å¼ã€‚

å¯¹äºç»“æ„ä½“ï¼Œ`println!` åº”è¯¥ç”¨æ¥è¾“å‡ºçš„æ ¼å¼æ˜¯ä¸æ˜ç¡®çš„ï¼Œå› ä¸ºè¿™æœ‰æ›´å¤šæ˜¾ç¤ºçš„å¯èƒ½æ€§ï¼šæ˜¯å¦éœ€è¦é€—å·ï¼Ÿéœ€è¦æ‰“å°å‡ºå¤§æ‹¬å·å—ï¼Ÿæ‰€æœ‰å­—æ®µéƒ½åº”è¯¥æ˜¾ç¤ºå—ï¼Ÿç”±äºè¿™ç§ä¸ç¡®å®šæ€§ï¼ŒRust ä¸ä¼šå°è¯•çŒœæµ‹æˆ‘ä»¬çš„æ„å›¾ï¼Œæ‰€ä»¥`ç»“æ„ä½“å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ª Display å®ç°`æ¥ä½¿ç”¨ `println!` ä¸ `{}` å ä½ç¬¦ã€‚

æ‰“å°ç»“æ„ä½“æ—¶:
- åœ¨ `{} `ä¸­åŠ å…¥ `:? `æŒ‡ç¤ºç¬¦å‘Šè¯‰ `println!` æˆ‘ä»¬æƒ³è¦ä½¿ç”¨å«åš `Debug` çš„è¾“å‡ºæ ¼å¼ã€‚
- ç»“æ„ä½“å®šä¹‰ä¹‹å‰åŠ ä¸Šå¤–éƒ¨å±æ€§ #[derive(Debug)]

> å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´å¤§çš„ç»“æ„ä½“æ—¶ï¼Œèƒ½æœ‰æ›´æ˜“è¯»ä¸€ç‚¹çš„è¾“å‡ºå°±å¥½äº†ï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨` {:#?}` æ›¿æ¢ println! å­—ç¬¦ä¸²ä¸­çš„ `{:?}`

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    // Use {:?}
    println!("rect1 is {:?}", rect1);
}
```

### ä½¿ç”¨ dbg!
```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let scale = 2;
    let rect1 = Rectangle {
        // dbg! è¿”å›è¡¨è¾¾å¼çš„å€¼çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ width å­—æ®µå°†è·å¾—ç›¸åŒçš„å€¼ï¼Œå°±åƒæˆ‘ä»¬åœ¨é‚£é‡Œæ²¡æœ‰ dbg! è°ƒç”¨ä¸€æ ·
        width: dbg!(30 * scale),
        height: 50,
    };
    // æˆ‘ä»¬ä¸å¸Œæœ› dbg! æ‹¥æœ‰ rect1 çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ dbg! æ—¶ä¼ é€’ä¸€ä¸ªå¼•ç”¨
    dbg!(&rect1);
}
```

## 5.3 æ–¹æ³•è¯­æ³•

`æ–¹æ³•ï¼ˆmethodï¼‰`ä¸å‡½æ•°ç±»ä¼¼ï¼šå®ƒä»¬ä½¿ç”¨ fn å…³é”®å­—å’Œåç§°å£°æ˜ï¼Œå¯ä»¥æ‹¥æœ‰å‚æ•°å’Œè¿”å›å€¼ï¼ŒåŒæ—¶åŒ…å«åœ¨æŸå¤„è°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¼šæ‰§è¡Œçš„ä»£ç ã€‚

ä¸å‡½æ•°æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç»“æ„ä½“çš„ä¸Šä¸‹æ–‡`impl`ä¸­è¢«å®šä¹‰ï¼ˆæˆ–è€…æ˜¯æšä¸¾æˆ– trait å¯¹è±¡çš„ä¸Šä¸‹æ–‡ï¼Œå°†åˆ†åˆ«åœ¨ç¬¬å…­ç« å’Œç¬¬åä¸ƒç« è®²è§£ï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯ `self` ï¼Œå®ƒä»£è¡¨è°ƒç”¨è¯¥æ–¹æ³•çš„ç»“æ„ä½“å®ä¾‹ã€‚

> `method` æ˜¯ ç»“æ„ä½“ `å®ç°impl` ä¸­å®šä¹‰çš„

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}
 
impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        rect1.area()
    );
}
```

#### getter
```rust
impl Rectangle {

    fn width(&self) -> u32 {
        self.width
    }
}

pub(crate) fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };
    
    println!(
        "The width of the rectangle is {} square pixels.",
        rect1.width()
    );
}
```

åœ¨ area çš„ç­¾åä¸­ï¼Œä½¿ç”¨ &self æ¥æ›¿ä»£ rectangle: &Rectangleï¼Œ`&self å®é™…ä¸Šæ˜¯ self: &Self çš„ç¼©å†™ã€‚`, æœ‰4ç§ç¼©å†™ï¼š
- self è·å–æ‰€æœ‰æƒ
- &self ä»…ä»…è¯»å–
- mut self è·å–æ‰€æœ‰æƒ
- &mut self åšå‡ºä¿®æ”¹

è¿™é‡Œé€‰æ‹© `&self `çš„ç†ç”±è·Ÿåœ¨å‡½æ•°ç‰ˆæœ¬ä¸­ä½¿ç”¨ &Rectangle æ˜¯ç›¸åŒçš„ï¼šæˆ‘ä»¬å¹¶ä¸æƒ³è·å–æ‰€æœ‰æƒï¼Œåªå¸Œæœ›èƒ½å¤Ÿè¯»å–ç»“æ„ä½“ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å†™å…¥ã€‚

å¦‚æœæƒ³è¦åœ¨æ–¹æ³•ä¸­æ”¹å˜è°ƒç”¨æ–¹æ³•çš„å®ä¾‹ï¼Œéœ€è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸º `&mut self`

> ä½¿ç”¨æ–¹æ³•æ›¿ä»£å‡½æ•°çš„ç›®çš„ï¼š
> ä¸éœ€è¦åœ¨æ¯ä¸ªå‡½æ•°ç­¾åä¸­é‡å¤ self çš„ç±»å‹ä¹‹å¤–ï¼Œ
> å…¶ä¸»è¦å¥½å¤„åœ¨äºç»„ç»‡æ€§ã€‚æˆ‘ä»¬å°†æŸä¸ªç±»å‹å®ä¾‹èƒ½åšçš„æ‰€æœ‰äº‹æƒ…éƒ½ä¸€èµ·æ”¾å…¥ impl å—ä¸­ï¼Œè€Œä¸æ˜¯è®©å°†æ¥çš„ç”¨æˆ·åœ¨æˆ‘ä»¬çš„åº“ä¸­åˆ°å¤„å¯»æ‰¾ Rectangle çš„åŠŸèƒ½ã€‚


Getters å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ `å¯ä»¥æŠŠå­—æ®µå˜æˆç§æœ‰çš„ï¼Œä½†æ–¹æ³•æ˜¯å…¬å…±çš„`ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå¯¹å­—æ®µçš„åªè¯»è®¿é—®ä½œä¸ºè¯¥ç±»å‹å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚

#### -> è¿ç®—ç¬¦åˆ°å“ªå»äº†ï¼Ÿ
åœ¨ C/C++ è¯­è¨€ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ï¼š`.` ç›´æ¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè€Œ `->` åœ¨ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆä¸Šè°ƒç”¨æ–¹æ³•, è¿™æ—¶éœ€è¦å…ˆ`è§£å¼•ç”¨ï¼ˆdereferenceï¼‰æŒ‡é’ˆ`ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ object æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆ `object->something()` å°±åƒ `(*object).something()` ä¸€æ ·ã€‚

Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ -> ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« `è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨ï¼ˆautomatic referencing and dereferencingï¼‰`çš„åŠŸèƒ½ã€‚`æ–¹æ³•è°ƒç”¨`æ˜¯ Rust ä¸­å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹ã€‚


### å¸¦æœ‰æ›´å¤šå‚æ•°çš„æ–¹æ³•
```rust
impl Rectangle {
    fn can_hold(&self, another_rectangle: &Rectangle) -> bool {
        self.width >= another_rectangle.width
            && self.height >= another_rectangle.height
    }
}
```

### å…³è”å‡½æ•°
æ‰€æœ‰åœ¨ `impl` å—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸º `å…³è”å‡½æ•°ï¼ˆassociated functionsï¼‰`ï¼Œå› ä¸ºå®ƒä»¬ä¸ `impl` åé¢å‘½åçš„ç±»å‹ç›¸å…³ã€‚

å¯ä»¥å®šä¹‰`ä¸ä»¥ self ä¸ºç¬¬ä¸€å‚æ•°çš„å…³è”å‡½æ•°ï¼ˆå› æ­¤ä¸æ˜¯æ–¹æ³•ï¼‰`ï¼Œå› ä¸ºå®ƒä»¬å¹¶`ä¸ä½œç”¨äºä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹`ã€‚æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼šåœ¨ String ç±»å‹ä¸Šå®šä¹‰çš„ `String::from` å‡½æ•°ã€‚

ä¸æ˜¯æ–¹æ³•çš„å…³è”å‡½æ•°`ç»å¸¸è¢«ç”¨ä½œè¿”å›ä¸€ä¸ªç»“æ„ä½“æ–°å®ä¾‹çš„æ„é€ å‡½æ•°`ã€‚

> ä½¿ç”¨ç»“æ„ä½“åå’Œ `::` è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªå…³è”å‡½æ•°

```rust
impl Rectangle {
    fn square(size: u32) -> Self { // Self å³æ˜¯ Rectangle
        Self {
            width: size,
            height: size,
        }
    }
}
```

# 6. Enums and Pattern Matching

enums æä¾›äº†ä¸€ç§è¯´æ˜ä¸€ä¸ª value æ˜¯ä¸€ç»„å¯èƒ½çš„ value ä¹‹ä¸€çš„æ–¹æ³•

å‡è®¾æˆ‘ä»¬è¦å¤„ç† IP åœ°å€ã€‚ç›®å‰è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸¤ä¸ªä¸»è¦ IP æ ‡å‡†ï¼šIPv4ï¼ˆversion fourï¼‰å’Œ IPv6ï¼ˆversion sixï¼‰ã€‚è¿™æ˜¯æˆ‘ä»¬çš„ç¨‹åºå¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰å¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼šæ‰€ä»¥å¯ä»¥ `æšä¸¾` å‡ºæ‰€æœ‰å¯èƒ½çš„å€¼. 

ä»»ä½•ä¸€ä¸ª IP åœ°å€è¦ä¹ˆæ˜¯ IPv4 çš„è¦ä¹ˆæ˜¯ IPv6 çš„ï¼Œè€Œä¸”ä¸èƒ½ä¸¤è€…éƒ½æ˜¯ã€‚IP åœ°å€çš„è¿™ä¸ªç‰¹æ€§ä½¿å¾—æšä¸¾æ•°æ®ç»“æ„éå¸¸é€‚åˆè¿™ä¸ªåœºæ™¯ï¼Œå› ä¸ºæšä¸¾å€¼åªå¯èƒ½æ˜¯å…¶ä¸­ä¸€ä¸ªæˆå‘˜ã€‚

```rust
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

// ç±»ä¼¼äºå®šä¹‰å¤šä¸ªä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼Œå¦‚ä¸‹
struct QuitMessage; // ç±»å•å…ƒç»“æ„ä½“
struct MoveMessage {
    x: i32,
    y: i32,
}
struct WriteMessage(String); // å…ƒç»„ç»“æ„ä½“
struct ChangeColorMessage(i32, i32, i32); // å…ƒç»„ç»“æ„ä½“
```

æšä¸¾è¿˜æœ‰å¦ä¸€ä¸ªç›¸ä¼¼ç‚¹ï¼šå°±åƒå¯ä»¥ä½¿ç”¨ `impl` æ¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•é‚£æ ·
```rust
    impl Message {
        fn call(&self) {
            // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“
        }
    }

    let m = Message::Write(String::from("hello"));
    m.call();
```

### Option æšä¸¾å’Œå…¶ç›¸å¯¹äºç©ºå€¼çš„ä¼˜åŠ¿

`Option` æ˜¯æ ‡å‡†åº“å®šä¹‰çš„ä¸€ä¸ªæšä¸¾. `Option` ç±»å‹åº”ç”¨å¹¿æ³›å› ä¸ºå®ƒç¼–ç äº†ä¸€ä¸ªéå¸¸æ™®éçš„åœºæ™¯ï¼Œ`å³ä¸€ä¸ªå€¼è¦ä¹ˆæœ‰å€¼è¦ä¹ˆæ²¡å€¼ã€‚`

Rust å¹¶`æ²¡æœ‰`å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­æœ‰çš„`ç©ºå€¼åŠŸèƒ½`ã€‚ç©ºå€¼ï¼ˆNull ï¼‰æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒä»£è¡¨æ²¡æœ‰å€¼ã€‚ç©ºå€¼æ˜¯ä¸€ä¸ªå› ä¸ºæŸç§åŸå› ç›®å‰æ— æ•ˆæˆ–ç¼ºå¤±çš„å€¼ã€‚
åœ¨æœ‰ç©ºå€¼çš„è¯­è¨€ä¸­ï¼Œå˜é‡æ€»æ˜¯è¿™ä¸¤ç§çŠ¶æ€ä¹‹ä¸€ï¼šç©ºå€¼å’Œéç©ºå€¼ã€‚

`Rust å¹¶æ²¡æœ‰ç©ºå€¼`ï¼Œä¸è¿‡å®ƒç¡®å®æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ç¼–ç å­˜åœ¨æˆ–ä¸å­˜åœ¨æ¦‚å¿µçš„æšä¸¾ã€‚è¿™ä¸ªæšä¸¾æ˜¯ `Option<T>`, å®ƒå®šä¹‰äºæ ‡å‡†åº“ä¸­:
```rust
enum Option<T> {
    None,
    Some(T),
}
```

`Option<T> `æšä¸¾æ˜¯å¦‚æ­¤æœ‰ç”¨ä»¥è‡³äºå®ƒç”šè‡³è¢«åŒ…å«åœ¨äº† `prelude` ä¹‹ä¸­, å¯ä»¥ä¸éœ€è¦ Option:: å‰ç¼€æ¥`ç›´æ¥ä½¿ç”¨ Some å’Œ None`

> <T> è¯­æ³•æ˜¯ä¸€ä¸ªæˆ‘ä»¬è¿˜æœªè®²åˆ°çš„ Rust åŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹å‚æ•°ï¼Œç¬¬åç« ä¼šæ›´è¯¦ç»†çš„è®²è§£æ³›å‹ã€‚

æˆ‘ä»¬åœ¨ Some æˆå‘˜ä¸­æŒ‡å®šäº†å€¼ï¼Œ`Rust å¯ä»¥æ¨æ–­å…¶ç±»å‹ã€‚`
```rust
    // some_number çš„ç±»å‹æ˜¯ Option<i32>
    let some_number = Some(5);
    // some_char çš„ç±»å‹æ˜¯ Option<char>
    let some_char = Some('e');
    // éœ€è¦æŒ‡å®š Option æ•´ä½“çš„ç±»å‹ï¼Œå› ä¸ºç¼–è¯‘å™¨åªé€šè¿‡ None å€¼æ— æ³•æ¨æ–­å‡º Some æˆå‘˜ä¿å­˜çš„å€¼çš„ç±»å‹
    // æˆ‘ä»¬å‘Šè¯‰ Rust å¸Œæœ› absent_number æ˜¯ Option<i32> ç±»å‹çš„ã€‚
    let absent_number: Option<i32> = None;
```

`Option<T>` ä¸ºä»€ä¹ˆå°±æ¯”ç©ºå€¼è¦å¥½å‘¢ï¼Ÿ
-> å› ä¸º `Option<T>` å’Œ `T`ï¼ˆè¿™é‡Œ `T` å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰æ˜¯ä¸åŒçš„ç±»å‹ï¼Œç¼–è¯‘å™¨ä¸å…è®¸åƒä¸€ä¸ª`è‚¯å®šæœ‰æ•ˆçš„å€¼`é‚£æ ·ä½¿ç”¨ `Option<T>`
```rust
    let x: i8 = 5;
    let y: Option<i8> = Some(5);

    let sum = x + y;
```
ä¸Šè¿°ä»£ç ä¼šæŠ¥é”™ï¼šerror[E0277]: cannot add `Option<i8>` to `i8`ã€‚å› ä¸ºå®ƒå°è¯•å°† `Option<i8>` ä¸ `i8` ç›¸åŠ .
æ¢å¥è¯è¯´ï¼Œåœ¨å¯¹ `Option<T>` è¿›è¡Œè¿ç®—ä¹‹å‰å¿…é¡»å°†å…¶è½¬æ¢ä¸º` T`.

å¦‚ä½•ä» `Some` æˆå‘˜ä¸­å–å‡º `T` çš„å€¼æ¥ä½¿ç”¨å®ƒå‘¢?
-> ä¸ºäº†ä½¿ç”¨` Option<T>` å€¼ï¼Œéœ€è¦ç¼–å†™å¤„ç†æ¯ä¸ªæˆå‘˜çš„ä»£ç ã€‚ä½ æƒ³è¦ä¸€äº›ä»£ç åªå½“æ‹¥æœ‰ `Some(T)` å€¼æ—¶è¿è¡Œï¼Œå…è®¸è¿™äº›ä»£ç ä½¿ç”¨å…¶ä¸­çš„ `T`ã€‚ä¹Ÿå¸Œæœ›ä¸€äº›ä»£ç åªåœ¨å€¼ä¸º `None` æ—¶è¿è¡Œï¼Œè¿™äº›ä»£ç å¹¶æ²¡æœ‰ä¸€ä¸ªå¯ç”¨çš„ `T` `å€¼ã€‚match` è¡¨è¾¾å¼å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå¤„ç†æšä¸¾çš„æ§åˆ¶æµç»“æ„


## 6.2 match æ§åˆ¶æµç»“æ„
```rust
enum Coin {
    Penny,
    Nickel,
    Dime,
    Quarter,
}

fn value_in_cents(coin: Coin) -> u8 {
    match coin {
        Coin::Penny => {
            println!("Lucky penny!");
            1
        }, // åˆ†æ”¯åçš„é€—å·æ˜¯å¯é€‰çš„
        Coin::Nickel => 5,
        Coin::Dime => 10,
        Coin::Quarter => 25,
    }
}
```

### ç»‘å®šå€¼çš„æ¨¡å¼
```rust
#[derive(Debug)] // è¿™æ ·å¯ä»¥ç«‹åˆ»çœ‹åˆ°å·çš„åç§°
enum UsState {
    Alabama,
    Alaska,
    // --snip--
}

enum Coin {
    Penny,
    Nickel,
    Dime,
    Quarter(UsState),
}

fn value_in_cents(coin: Coin) -> u8 {
    match coin {
        Coin::Penny => 1,
        Coin::Nickel => 5,
        Coin::Dime => 10,
        Coin::Quarter(state) => {
            println!("State quarter from {:?}!", state);
            25
        }
    }
}
```
è°ƒç”¨ `value_in_cents(Coin::Quarter(UsState::Alaska))` ä¼šæ‰“å° `State quarter from Alaska`, ä¸”è¿”å›å€¼ä¸º`25`

### åŒ¹é… Option<T>
